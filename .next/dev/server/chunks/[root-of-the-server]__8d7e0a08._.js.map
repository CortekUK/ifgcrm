{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghulam/projects/ifgcrm/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  const supabaseUrl =\n    process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL || \"https://cujprjusexjzuapydiuf.supabase.co\"\n\n  const supabaseKey =\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ||\n    process.env.SUPABASE_ANON_KEY ||\n    \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1anByanVzZXhqenVhcHlkaXVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MDg1MTQsImV4cCI6MjA3ODE4NDUxNH0.TTRG0g8vh3-IpQ3YkJxFoLlQEa5IfAAkJIUrJa1XogA\"\n\n  return createServerClient(supabaseUrl, supabaseKey, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing\n          // user sessions.\n        }\n      },\n    },\n  })\n}\n\nexport { createClient as createServerClient }\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM,cACJ,QAAQ,GAAG,CAAC,wBAAwB,IAAI,QAAQ,GAAG,CAAC,YAAY,IAAI;IAEtE,MAAM,cACJ,wPACA,QAAQ,GAAG,CAAC,iBAAiB,IAC7B;IAEF,OAAO,IAAA,iMAAkB,EAAC,aAAa,aAAa;QAClD,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AACF","debugId":null}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghulam/projects/ifgcrm/app/api/contacts/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { createClient } from \"@/lib/supabase/server\"\n\nexport async function GET(request: NextRequest) {\n  try {\n    const supabase = await createClient()\n    const { searchParams } = new URL(request.url)\n\n    const page = parseInt(searchParams.get(\"page\") || \"1\")\n    const pageSize = parseInt(searchParams.get(\"pageSize\") || \"50\")\n    const search = searchParams.get(\"search\")\n    const programmeId = searchParams.get(\"programmeId\")\n    const tag = searchParams.get(\"tag\")\n    const recruiterId = searchParams.get(\"recruiterId\")\n    const country = searchParams.get(\"country\")\n    const status = searchParams.get(\"status\")\n    const listId = searchParams.get(\"listId\")\n\n    let query = supabase\n      .from(\"leads\")\n      .select(\n        `\n        id,\n        name,\n        email,\n        phone,\n        status,\n        notes,\n        created_at,\n        program:programs!program_id(id, name),\n        recruiter:profiles!user_id(id, full_name)\n      `,\n        { count: \"exact\" }\n      )\n\n    if (search) {\n      query = query.or(`name.ilike.%${search}%,email.ilike.%${search}%`)\n    }\n\n    if (programmeId && programmeId !== \"all\") {\n      query = query.eq(\"program_id\", programmeId)\n    }\n\n    if (recruiterId && recruiterId !== \"all\") {\n      query = query.eq(\"user_id\", recruiterId)\n    }\n\n    if (status && status !== \"all\") {\n      query = query.eq(\"status\", status)\n    }\n\n    if (country && country !== \"all\") {\n      // This filter will be applied when country column exists\n      query = query.eq(\"country\", country)\n    }\n\n    const offset = (page - 1) * pageSize\n    query = query.range(offset, offset + pageSize - 1).order(\"created_at\", { ascending: false })\n\n    const { data, error, count } = await query\n\n    if (error) {\n      console.error(\"[v0] Error querying leads:\", error)\n      throw error\n    }\n\n    let filteredData = data || []\n    if (listId && listId !== \"all\") {\n      try {\n        const { data: memberships } = await supabase\n          .from(\"list_memberships\")\n          .select(\"lead_id\")\n          .eq(\"list_id\", listId)\n\n        if (memberships) {\n          const memberLeadIds = new Set(memberships.map((m) => m.lead_id))\n          filteredData = filteredData.filter((lead) => memberLeadIds.has(lead.id))\n        }\n      } catch (listError) {\n        // Lists table might not exist yet, continue without filtering\n        console.log(\"[v0] Lists table not available yet, skipping list filter\")\n      }\n    }\n\n    let listMembershipsMap: Record<string, any[]> = {}\n    if (filteredData.length > 0) {\n      try {\n        const leadIds = filteredData.map((lead) => lead.id)\n        const { data: memberships } = await supabase\n          .from(\"list_memberships\")\n          .select(\n            `\n            lead_id,\n            list:lists(id, name)\n          `\n          )\n          .in(\"lead_id\", leadIds)\n\n        if (memberships) {\n          memberships.forEach((membership: any) => {\n            if (!listMembershipsMap[membership.lead_id]) {\n              listMembershipsMap[membership.lead_id] = []\n            }\n            if (membership.list) {\n              listMembershipsMap[membership.lead_id].push({\n                id: membership.list.id,\n                name: membership.list.name,\n              })\n            }\n          })\n        }\n      } catch (listError) {\n        // Lists table might not exist yet, continue without list data\n        console.log(\"[v0] Lists table not available yet, skipping list memberships\")\n      }\n    }\n\n    const contacts = filteredData.map((lead: any) => ({\n      id: lead.id,\n      name: lead.name,\n      email: lead.email,\n      phone: lead.phone || null,\n      programme: lead.program\n        ? { id: lead.program.id, name: lead.program.name }\n        : null,\n      recruiter: lead.recruiter\n        ? { id: lead.recruiter.id, name: lead.recruiter.full_name }\n        : null,\n      tags: [], // TODO: Parse from notes or add tags column\n      lists: listMembershipsMap[lead.id] || [],\n      country: null, // TODO: Add country column to leads table\n      status: lead.status || null,\n      createdAt: lead.created_at,\n    }))\n\n    const totalCount = listId && listId !== \"all\" ? contacts.length : (count || 0)\n    const totalPages = Math.ceil(totalCount / pageSize)\n\n    return NextResponse.json({\n      data: contacts,\n      pagination: {\n        page,\n        pageSize,\n        total: totalCount,\n        totalPages,\n      },\n    })\n  } catch (error) {\n    console.error(\"[v0] Error fetching contacts:\", error)\n    return NextResponse.json(\n      { error: \"Failed to load contacts\" },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}