module.exports=[47349,(a,b,c)=>{"use strict";var d=a.r(72131);d.useState,d.useEffect,d.useLayoutEffect,d.useDebugValue,c.useSyncExternalStore=void 0!==d.useSyncExternalStore?d.useSyncExternalStore:function(a,b){return b()}},87610,(a,b,c)=>{"use strict";b.exports=a.r(47349)},74332,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(6331),f=a.i(87682),g=a.i(40695),h=a.i(5522),i=a.i(84505),j=a.i(41710),k=a.i(15618),l=a.i(87532);function m(a){return a.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)}let n={"Initial Lead":"border-l-blue-400","Zoom Scheduled":"border-l-amber-400","Zoom Completed":"border-l-purple-400","Application Sent":"border-l-emerald-400",Accepted:"border-l-gray-400"};function o({deal:a,stageName:d,onClick:e,onDragStart:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),k=n[d]||"border-l-gray-400";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",rel:"stylesheet"}),(0,b.jsxs)("div",{draggable:!0,onDragStart:b=>{b.dataTransfer.setData("dealId",a.id.toString()),f(),j(!0)},onDragEnd:()=>j(!1),onClick:e,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),className:`group cursor-pointer rounded-xl border bg-white p-4 shadow-sm transition-all duration-200 ${k} border-l-4 ${i?"scale-105 opacity-50 shadow-lg":g?"shadow-md border-[#0A47B1] bg-[#F8FAFF]":"border-[#E6E8F0]"}`,style:{borderRadius:"12px"},children:[(0,b.jsx)("div",{className:"mb-3 flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-xs font-semibold text-white",children:m(a.player_name)}),(0,b.jsx)("div",{children:(0,b.jsx)("h4",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"15px",color:"#0A0A0A"},children:a.player_name})})]})}),(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsxs)("div",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif",fontWeight:600,color:"#00A35C",fontSize:"14px"},children:["£",a.deal_value.toLocaleString()]})}),(0,b.jsx)("div",{className:"mb-2 inline-block rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700",children:a.programme}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("div",{className:"h-5 w-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] font-medium text-gray-600",children:m(a.recruiter)}),(0,b.jsx)("span",{children:a.recruiter})]}),(0,b.jsx)("div",{className:"text-gray-400",children:a.last_activity})]})]})]})}var p=a.i(77687),q=a.i(70106);let r=(0,q.default)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var s=a.i(15115),t=a.i(24569),u=a.i(81560),v=a.i(65733),w=a.i(17171),x=a.i(76504),y=a.i(73570);function z({stage:a,availableStages:d,open:e,onClose:h,onConfirm:i}){let[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1);if(!a)return null;let n=a.deals.length>0,o=a.deals.length,p=async()=>{m(!0);try{n&&j?await i(a,Number.parseInt(j)):await i(a),h(),k("")}finally{m(!1)}},q=()=>{l||(h(),k(""))};return(0,b.jsx)(v.Dialog,{open:e,onOpenChange:q,children:(0,b.jsxs)(v.DialogContent,{className:"sm:max-w-[480px]",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsxs)(v.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(y.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Delete Stage"]}),(0,b.jsx)(v.DialogDescription,{children:n?`This stage contains ${o} deal${o>1?"s":""}. Please select where to move ${o>1?"them":"it"} before deleting.`:"Are you sure you want to delete this stage? This action cannot be undone."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"rounded-lg bg-muted/50 p-3 border border-border",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Stage to delete:"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.name})]}),n&&d.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(w.Label,{htmlFor:"target-stage",children:"Move deals to"}),(0,b.jsxs)(f.Select,{value:j,onValueChange:k,children:[(0,b.jsx)(f.SelectTrigger,{id:"target-stage",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select a stage"})}),(0,b.jsx)(f.SelectContent,{children:d.map(a=>(0,b.jsxs)(f.SelectItem,{value:a.id.toString(),children:[a.name," (",a.deals.length," deals)"]},a.id))})]}),!j&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"You must select a target stage to move the deals to."})]}),n&&0===d.length&&(0,b.jsx)("div",{className:"rounded-lg bg-destructive/10 border border-destructive/20 p-3",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:"Cannot delete this stage. There are no other stages to move the deals to. Please create another stage first."})})]}),(0,b.jsxs)(v.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:q,disabled:l,children:"Cancel"}),(0,b.jsx)(g.Button,{variant:"destructive",onClick:p,disabled:l||n&&(!j||0===d.length),children:l?"Deleting...":"Delete Stage"})]})]})})}let A={Scheduled:"#a855f7","Zoom Scheduled":"#a855f7","Reschedule Zoom":"#10b981","Follow Up":"#facc15","Collecting Documents":"#fb923c",Applied:"#f43f5e","Conditional Offer":"#f97316","Dormant Lead":"#1d4ed8","Initial Lead":"#14b8a6","In Contact":"#38bdf8","Zoom Completed":"#a855f7","Application Sent":"#10b981",Accepted:"#6b7280"};function B({pipelineData:a,onDealClick:d,onDealMove:e,onStageEdit:f,onAddDeal:i}){let[j,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[q,y]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),{toast:F}=(0,p.useToast)(),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(""),O=()=>{y(null)},P=async(b,c)=>{if(b.preventDefault(),y(null),j&&m!==c){let b=a.stages.find(a=>a.id===c);await e(j.id,c),F({title:"Stage updated",description:`Moved to ${b?.name||"new stage"}`})}l(null),n(null)},Q=async(b,c)=>{try{b.deals.length>0&&c&&await fetch(`/api/pipelines/${a.id}/stages/${b.id}/move-deals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toStageId:c})}),(await fetch(`/api/pipelines/${a.id}/stages/${b.id}`,{method:"DELETE"})).ok&&(F({title:"Stage deleted",description:`${b.name} has been removed from the pipeline.`}),window.dispatchEvent(new Event("stageDeleted")))}catch(a){console.error("Failed to delete stage:",a),F({title:"Error",description:"Failed to delete stage. Please try again.",variant:"destructive"})}},R=async a=>{a.preventDefault(),C(!1);let b=a.dataTransfer.getData("dealId");if(b&&j){try{(await fetch(`/api/deals/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"won",closedAt:new Date().toISOString()})})).ok&&(F({title:"Deal marked as Won",description:`${j.player_name}'s deal has been marked as won.`}),window.dispatchEvent(new Event("dealCreated")))}catch(a){console.error("Failed to mark deal as won:",a),F({title:"Error",description:"Failed to mark deal as won. Please try again.",variant:"destructive"})}l(null),n(null)}},S=async a=>{a.preventDefault(),E(!1);let b=a.dataTransfer.getData("dealId");if(b&&j){try{(await fetch(`/api/deals/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"lost",closedAt:new Date().toISOString()})})).ok&&(F({title:"Deal marked as Lost",description:`${j.player_name}'s deal has been marked as lost.`}),window.dispatchEvent(new Event("dealCreated")))}catch(a){console.error("Failed to mark deal as lost:",a),F({title:"Error",description:"Failed to mark deal as lost. Please try again.",variant:"destructive"})}l(null),n(null)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600&display=swap",rel:"stylesheet"}),(0,b.jsxs)("div",{className:"h-full overflow-x-auto overflow-y-hidden rounded-lg border border-border bg-card p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"mb-4 flex gap-4",children:[(0,b.jsx)("div",{className:`won-zone flex-1 rounded-lg border-2 border-dashed p-6 text-center transition-all ${B?"border-green-500 bg-green-50 scale-[1.02]":"border-green-300 bg-green-50/50 hover:bg-green-50"}`,onDragOver:a=>{a.preventDefault(),C(!0)},onDragLeave:()=>{C(!1)},onDrop:R,children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-green-700",children:B?"Drop to mark as Won":"Drag a deal here to mark as Won"}),(0,b.jsx)("div",{className:"text-xs text-green-600",children:"The deal will be closed and removed from the board"})]})}),(0,b.jsx)("div",{className:`lost-zone flex-1 rounded-lg border-2 border-dashed p-6 text-center transition-all ${D?"border-red-500 bg-red-50 scale-[1.02]":"border-red-300 bg-red-50/50 hover:bg-red-50"}`,onDragOver:a=>{a.preventDefault(),E(!0)},onDragLeave:()=>{E(!1)},onDrop:S,children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-red-700",children:D?"Drop to mark as Lost":"Drag a deal here to mark as Lost"}),(0,b.jsx)("div",{className:"text-xs text-red-600",children:"The deal will be closed and removed from the board"})]})})]}),(0,b.jsx)("div",{className:"inline-flex gap-4 pb-2 animate-fade-in-up",children:a.stages.map((a,c)=>{let e=A[a.name]||"#6b7280",f=q===a.id,g=a.deals.reduce((a,b)=>a+(b.deal_value||0),0);return(0,b.jsxs)("div",{className:`flex w-80 flex-shrink-0 flex-col rounded-lg bg-card ${f?"ring-2 ring-primary ring-opacity-50":""} transition-all duration-200`,style:{animationDelay:`${80*c}ms`,borderLeft:c>0?"1px solid #E6E8F0":"none"},onDragOver:b=>{var c;return c=a.id,void(b.preventDefault(),y(c))},onDragLeave:O,onDrop:b=>P(b,a.id),children:[(0,b.jsxs)("div",{className:"px-4 rounded-t-lg border-b border-white/20",style:{backgroundColor:e,paddingTop:"15px",paddingBottom:"12px"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-white text-sm",style:{fontFamily:"Oswald, sans-serif",fontWeight:500,letterSpacing:"0.7px",color:"#FFFFFF"},children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[i&&(0,b.jsxs)("button",{onClick:()=>i(a.id),className:"flex items-center gap-1 px-2 py-1 rounded text-xs text-white/90 hover:bg-white/20 transition-colors",title:"Add deal to this stage",children:[(0,b.jsx)(k.Plus,{className:"h-3 w-3"}),"Add deal"]}),(0,b.jsxs)(x.DropdownMenu,{children:[(0,b.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)("button",{className:"flex h-6 w-6 items-center justify-center rounded hover:bg-white/20 transition-colors",children:(0,b.jsx)(s.MoreVertical,{className:"h-4 w-4 text-white"})})}),(0,b.jsxs)(x.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>{H(a),N(A[a.name]||"#6b7280"),J(!0)},children:[(0,b.jsx)(t.Edit,{className:"mr-2 h-4 w-4"}),"Edit Stage"]}),(0,b.jsxs)(x.DropdownMenuItem,{onClick:()=>L(a),className:"text-destructive focus:text-destructive",children:[(0,b.jsx)(u.Trash2,{className:"mr-2 h-4 w-4"}),"Delete Stage"]})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-0.5 text-xs text-white/90",children:[(0,b.jsxs)("div",{children:[a.deals.length," deals"]}),(0,b.jsxs)("div",{className:"font-semibold",children:["£",g.toLocaleString()]})]})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-3 p-4 pt-3 overflow-y-auto max-h-[600px]",children:[a.deals.map(c=>(0,b.jsx)(o,{deal:c,stageName:a.name,onClick:()=>d(c),onDragStart:()=>{var b;return b=a.id,void(l(c),n(b))}},c.id)),0===a.deals.length&&(0,b.jsxs)("div",{className:"flex h-32 flex-col items-center justify-center text-center",children:[(0,b.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted mb-2",children:(0,b.jsx)(r,{className:"h-6 w-6 text-muted-foreground"})}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No deals in this stage yet"}),i&&(0,b.jsxs)("button",{onClick:()=>i(a.id),className:"text-sm text-primary hover:text-primary/80 hover:underline font-medium flex items-center gap-1",children:[(0,b.jsx)(k.Plus,{className:"h-3 w-3"}),"Add deal"]})]})]})]},a.id)})})]}),(0,b.jsx)(v.Dialog,{open:I,onOpenChange:J,children:(0,b.jsxs)(v.DialogContent,{className:"max-w-3xl max-h-[90vh] my-4 overflow-hidden p-0 flex flex-col",children:[(0,b.jsx)("div",{className:"px-8 pt-8 pb-5 border-b border-border",children:(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{className:"text-[26px] font-semibold tracking-tight leading-tight",children:"Edit Stage"}),(0,b.jsx)("p",{className:"text-[15px] text-muted-foreground mt-2 leading-relaxed",children:"Customise your pipeline stage"})]})}),G&&(0,b.jsxs)("div",{className:"px-8 py-8 space-y-8 overflow-y-auto max-h-[calc(100vh-180px)]",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(w.Label,{htmlFor:"stage-name",className:"text-[15px] font-semibold text-foreground",children:"Stage Name"}),(0,b.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Give this stage a descriptive name"})]}),(0,b.jsx)(h.Input,{id:"stage-name",defaultValue:G.name,placeholder:"e.g. Initial Contact",className:"h-12 text-[15px] bg-background"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(w.Label,{className:"text-[15px] font-semibold text-foreground",children:"Stage Colour"}),(0,b.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Choose a colour to represent this stage"})]}),(0,b.jsxs)("div",{className:"space-y-4 bg-muted/30 rounded-lg p-5",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Preset Colours"}),(0,b.jsx)("div",{className:"grid grid-cols-8 gap-2.5",children:["#14b8a6","#38bdf8","#a855f7","#10b981","#fb923c","#f43f5e","#facc15","#6b7280"].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>N(a),className:`h-11 w-11 rounded-lg border-2 transition-all hover:scale-105 active:scale-95 ${M===a?"border-primary ring-4 ring-primary/20 shadow-lg":"border-border hover:border-border/60"}`,style:{backgroundColor:a},title:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-3 pt-3 border-t border-border/50",children:[(0,b.jsx)("p",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Custom Colour"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("input",{type:"color",value:M,onChange:a=>N(a.target.value),className:"h-12 w-20 cursor-pointer rounded-lg border-2 border-border",title:"Pick a custom colour"})}),(0,b.jsx)(h.Input,{value:M,onChange:a=>N(a.target.value),placeholder:"#000000",className:"h-12 flex-1 font-mono text-[13px] bg-background"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(w.Label,{htmlFor:"stage-order",className:"text-[15px] font-semibold text-foreground",children:"Display Order"}),(0,b.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Position of this stage in the pipeline (left to right)"})]}),(0,b.jsx)(h.Input,{id:"stage-order",type:"number",min:"1",defaultValue:G.order,placeholder:"1",className:"h-12 text-[15px] bg-background"})]})]}),(0,b.jsx)("div",{className:"px-8 py-6 border-t border-border bg-muted/20",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(g.Button,{size:"lg",className:"flex-1 h-12 text-[15px] font-medium shadow-sm gradient-primary",onClick:()=>{if(G){let a=document.getElementById("stage-name"),b=document.getElementById("stage-order");f(G.id,a.value,M,Number.parseInt(b.value)),J(!1)}},children:"Save Changes"}),(0,b.jsx)(g.Button,{size:"lg",variant:"outline",className:"flex-1 h-12 text-[15px] font-medium bg-background",onClick:()=>J(!1),children:"Cancel"})]})})]})}),(0,b.jsx)(z,{stage:K,availableStages:a.stages.filter(a=>a.id!==K?.id),open:!!K,onClose:()=>L(null),onConfirm:Q})]})}function C({open:a,onClose:d,onSuccess:e}){let[f,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),{toast:l}=(0,p.useToast)(),m=async a=>{a.preventDefault(),k(!0);try{(await fetch("/api/pipelines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f})})).ok?(l({title:"Pipeline created successfully"}),i(""),d(),e&&e()):l({title:"Failed to create pipeline",variant:"destructive"})}catch(a){l({title:"An error occurred",variant:"destructive"})}finally{k(!1)}};return(0,b.jsx)(v.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(v.DialogContent,{className:"sm:max-w-[440px]",children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{children:"Add pipeline"}),(0,b.jsx)(v.DialogDescription,{children:"Create a new pipeline for managing deals"})]}),(0,b.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(w.Label,{htmlFor:"pipeline-name",children:"Pipeline name *"}),(0,b.jsx)(h.Input,{id:"pipeline-name",value:f,onChange:a=>i(a.target.value),placeholder:"e.g. US College Recruitment",required:!0})]}),(0,b.jsxs)(v.DialogFooter,{children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:d,disabled:j,children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",className:"gradient-primary",disabled:j,children:j?"Creating...":"Create pipeline"})]})]})]})})}var D=a.i(46893),E=a.i(96221),F=a.i(46842),G=a.i(69769);let H=(0,q.default)("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);var I=a.i(32116),J=a.i(90166),K=a.i(4720),L=/[\\\/_+.#"@\[\(\{&]/,M=/[\\\/_+.#"@\[\(\{&]/g,N=/[\s-]/,O=/[\s-]/g;function P(a){return a.toLowerCase().replace(O," ")}var Q=a.i(97942),R=a.i(30553),S=a.i(92843),T=a.i(87610),U='[cmdk-group=""]',V='[cmdk-group-items=""]',W='[cmdk-item=""]',X=`${W}:not([aria-disabled="true"])`,Y="cmdk-item-select",Z="data-value",$=(a,b,c)=>{var d;return d=a,function a(b,c,d,e,f,g,h){if(g===c.length)return f===b.length?1:.99;var i=`${f},${g}`;if(void 0!==h[i])return h[i];for(var j,k,l,m,n=e.charAt(g),o=d.indexOf(n,f),p=0;o>=0;)(j=a(b,c,d,e,o+1,g+1,h))>p&&(o===f?j*=1:L.test(b.charAt(o-1))?(j*=.8,(l=b.slice(f,o-1).match(M))&&f>0&&(j*=Math.pow(.999,l.length))):N.test(b.charAt(o-1))?(j*=.9,(m=b.slice(f,o-1).match(O))&&f>0&&(j*=Math.pow(.999,m.length))):(j*=.17,f>0&&(j*=Math.pow(.999,o-f))),b.charAt(o)!==c.charAt(g)&&(j*=.9999)),(j<.1&&d.charAt(o-1)===e.charAt(g+1)||e.charAt(g+1)===e.charAt(g)&&d.charAt(o-1)!==e.charAt(g))&&.1*(k=a(b,c,d,e,o+1,g+2,h))>j&&(j=.1*k),j>p&&(p=j),o=d.indexOf(n,o+1);return h[i]=p,p}(d=c&&c.length>0?`${d+" "+c.join(" ")}`:d,b,P(d),P(b),0,0,{})},_=c.createContext(void 0),aa=c.createContext(void 0),ab=c.createContext(void 0),ac=c.forwardRef((a,b)=>{let d=am(()=>{var b,c;return{search:"",value:null!=(c=null!=(b=a.value)?b:a.defaultValue)?c:"",filtered:{count:0,items:new Map,groups:new Set}}}),e=am(()=>new Set),f=am(()=>new Map),g=am(()=>new Map),h=am(()=>new Set),i=ak(a),{label:j,children:k,value:l,onValueChange:m,filter:n,shouldFilter:o,loop:p,disablePointerSelection:q=!1,vimBindings:r=!0,...s}=a,t=(0,S.useId)(),u=(0,S.useId)(),v=(0,S.useId)(),w=c.useRef(null),x=aq();al(()=>{if(void 0!==l){let a=l.trim();d.current.value=a,y.emit()}},[l]),al(()=>{x(6,E)},[]);let y=c.useMemo(()=>({subscribe:a=>(h.current.add(a),()=>h.current.delete(a)),snapshot:()=>d.current,setState:(a,b,c)=>{var e,f,g;if(!Object.is(d.current[a],b)){if(d.current[a]=b,"search"===a)D(),B(),x(1,C);else if("value"===a&&(c||x(5,E),(null==(e=i.current)?void 0:e.value)!==void 0)){null==(g=(f=i.current).onValueChange)||g.call(f,null!=b?b:"");return}y.emit()}},emit:()=>{h.current.forEach(a=>a())}}),[]),z=c.useMemo(()=>({value:(a,b,c)=>{var e;b!==(null==(e=g.current.get(a))?void 0:e.value)&&(g.current.set(a,{value:b,keywords:c}),d.current.filtered.items.set(a,A(b,c)),x(2,()=>{B(),y.emit()}))},item:(a,b)=>(e.current.add(a),b&&(f.current.has(b)?f.current.get(b).add(a):f.current.set(b,new Set([a]))),x(3,()=>{D(),B(),d.current.value||C(),y.emit()}),()=>{g.current.delete(a),e.current.delete(a),d.current.filtered.items.delete(a);let b=F();x(4,()=>{D(),(null==b?void 0:b.getAttribute("id"))===a&&C(),y.emit()})}),group:a=>(f.current.has(a)||f.current.set(a,new Set),()=>{g.current.delete(a),f.current.delete(a)}),filter:()=>i.current.shouldFilter,label:j||a["aria-label"],getDisablePointerSelection:()=>i.current.disablePointerSelection,listId:t,inputId:v,labelId:u,listInnerRef:w}),[]);function A(a,b){var c,e;let f=null!=(e=null==(c=i.current)?void 0:c.filter)?e:$;return a?f(a,d.current.search,b):0}function B(){if(!d.current.search||!1===i.current.shouldFilter)return;let a=d.current.filtered.items,b=[];d.current.filtered.groups.forEach(c=>{let d=f.current.get(c),e=0;d.forEach(b=>{e=Math.max(a.get(b),e)}),b.push([c,e])});let c=w.current;G().sort((b,c)=>{var d,e;let f=b.getAttribute("id"),g=c.getAttribute("id");return(null!=(d=a.get(g))?d:0)-(null!=(e=a.get(f))?e:0)}).forEach(a=>{let b=a.closest(V);b?b.appendChild(a.parentElement===b?a:a.closest(`${V} > *`)):c.appendChild(a.parentElement===c?a:a.closest(`${V} > *`))}),b.sort((a,b)=>b[1]-a[1]).forEach(a=>{var b;let c=null==(b=w.current)?void 0:b.querySelector(`${U}[${Z}="${encodeURIComponent(a[0])}"]`);null==c||c.parentElement.appendChild(c)})}function C(){let a=G().find(a=>"true"!==a.getAttribute("aria-disabled")),b=null==a?void 0:a.getAttribute(Z);y.setState("value",b||void 0)}function D(){var a,b,c,h;if(!d.current.search||!1===i.current.shouldFilter){d.current.filtered.count=e.current.size;return}d.current.filtered.groups=new Set;let j=0;for(let f of e.current){let e=A(null!=(b=null==(a=g.current.get(f))?void 0:a.value)?b:"",null!=(h=null==(c=g.current.get(f))?void 0:c.keywords)?h:[]);d.current.filtered.items.set(f,e),e>0&&j++}for(let[a,b]of f.current)for(let c of b)if(d.current.filtered.items.get(c)>0){d.current.filtered.groups.add(a);break}d.current.filtered.count=j}function E(){var a,b,c;let d=F();d&&((null==(a=d.parentElement)?void 0:a.firstChild)===d&&(null==(c=null==(b=d.closest(U))?void 0:b.querySelector('[cmdk-group-heading=""]'))||c.scrollIntoView({block:"nearest"})),d.scrollIntoView({block:"nearest"}))}function F(){var a;return null==(a=w.current)?void 0:a.querySelector(`${W}[aria-selected="true"]`)}function G(){var a;return Array.from((null==(a=w.current)?void 0:a.querySelectorAll(X))||[])}function H(a){let b=G()[a];b&&y.setState("value",b.getAttribute(Z))}function I(a){var b;let c=F(),d=G(),e=d.findIndex(a=>a===c),f=d[e+a];null!=(b=i.current)&&b.loop&&(f=e+a<0?d[d.length-1]:e+a===d.length?d[0]:d[e+a]),f&&y.setState("value",f.getAttribute(Z))}function J(a){let b=F(),c=null==b?void 0:b.closest(U),d;for(;c&&!d;)d=null==(c=a>0?function(a,b){let c=a.nextElementSibling;for(;c;){if(c.matches(b))return c;c=c.nextElementSibling}}(c,U):function(a,b){let c=a.previousElementSibling;for(;c;){if(c.matches(b))return c;c=c.previousElementSibling}}(c,U))?void 0:c.querySelector(X);d?y.setState("value",d.getAttribute(Z)):I(a)}let K=()=>H(G().length-1),L=a=>{a.preventDefault(),a.metaKey?K():a.altKey?J(1):I(1)},M=a=>{a.preventDefault(),a.metaKey?H(0):a.altKey?J(-1):I(-1)};return c.createElement(R.Primitive.div,{ref:b,tabIndex:-1,...s,"cmdk-root":"",onKeyDown:a=>{var b;if(null==(b=s.onKeyDown)||b.call(s,a),!a.defaultPrevented)switch(a.key){case"n":case"j":r&&a.ctrlKey&&L(a);break;case"ArrowDown":L(a);break;case"p":case"k":r&&a.ctrlKey&&M(a);break;case"ArrowUp":M(a);break;case"Home":a.preventDefault(),H(0);break;case"End":a.preventDefault(),K();break;case"Enter":if(!a.nativeEvent.isComposing&&229!==a.keyCode){a.preventDefault();let b=F();if(b){let a=new Event(Y);b.dispatchEvent(a)}}}}},c.createElement("label",{"cmdk-label":"",htmlFor:z.inputId,id:z.labelId,style:as},j),ar(a,a=>c.createElement(aa.Provider,{value:y},c.createElement(_.Provider,{value:z},a))))}),ad=c.forwardRef((a,b)=>{var d,e;let f=(0,S.useId)(),g=c.useRef(null),h=c.useContext(ab),i=c.useContext(_),j=ak(a),k=null!=(e=null==(d=j.current)?void 0:d.forceMount)?e:null==h?void 0:h.forceMount;al(()=>{if(!k)return i.item(f,null==h?void 0:h.id)},[k]);let l=ap(f,g,[a.value,a.children,g],a.keywords),m=c.useContext(aa),n=ao(a=>a.value&&a.value===l.current),o=ao(a=>!!k||!1===i.filter()||!a.search||a.filtered.items.get(f)>0);function p(){var a,b;q(),null==(b=(a=j.current).onSelect)||b.call(a,l.current)}function q(){m.setState("value",l.current,!0)}if(c.useEffect(()=>{let b=g.current;if(!(!b||a.disabled))return b.addEventListener(Y,p),()=>b.removeEventListener(Y,p)},[o,a.onSelect,a.disabled]),!o)return null;let{disabled:r,value:s,onSelect:t,forceMount:u,keywords:v,...w}=a;return c.createElement(R.Primitive.div,{ref:an([g,b]),...w,id:f,"cmdk-item":"",role:"option","aria-disabled":!!r,"aria-selected":!!n,"data-disabled":!!r,"data-selected":!!n,onPointerMove:r||i.getDisablePointerSelection()?void 0:q,onClick:r?void 0:p},a.children)}),ae=c.forwardRef((a,b)=>{let{heading:d,children:e,forceMount:f,...g}=a,h=(0,S.useId)(),i=c.useRef(null),j=c.useRef(null),k=(0,S.useId)(),l=c.useContext(_),m=ao(a=>!!f||!1===l.filter()||!a.search||a.filtered.groups.has(h));al(()=>l.group(h),[]),ap(h,i,[a.value,a.heading,j]);let n=c.useMemo(()=>({id:h,forceMount:f}),[f]);return c.createElement(R.Primitive.div,{ref:an([i,b]),...g,"cmdk-group":"",role:"presentation",hidden:!m||void 0},d&&c.createElement("div",{ref:j,"cmdk-group-heading":"","aria-hidden":!0,id:k},d),ar(a,a=>c.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":d?k:void 0},c.createElement(ab.Provider,{value:n},a))))}),af=c.forwardRef((a,b)=>{let{alwaysRender:d,...e}=a,f=c.useRef(null),g=ao(a=>!a.search);return d||g?c.createElement(R.Primitive.div,{ref:an([f,b]),...e,"cmdk-separator":"",role:"separator"}):null}),ag=c.forwardRef((a,b)=>{let{onValueChange:d,...e}=a,f=null!=a.value,g=c.useContext(aa),h=ao(a=>a.search),i=ao(a=>a.value),j=c.useContext(_),k=c.useMemo(()=>{var a;let b=null==(a=j.listInnerRef.current)?void 0:a.querySelector(`${W}[${Z}="${encodeURIComponent(i)}"]`);return null==b?void 0:b.getAttribute("id")},[]);return c.useEffect(()=>{null!=a.value&&g.setState("search",a.value)},[a.value]),c.createElement(R.Primitive.input,{ref:b,...e,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":j.listId,"aria-labelledby":j.labelId,"aria-activedescendant":k,id:j.inputId,type:"text",value:f?a.value:h,onChange:a=>{f||g.setState("search",a.target.value),null==d||d(a.target.value)}})}),ah=c.forwardRef((a,b)=>{let{children:d,label:e="Suggestions",...f}=a,g=c.useRef(null),h=c.useRef(null),i=c.useContext(_);return c.useEffect(()=>{if(h.current&&g.current){let a=h.current,b=g.current,c,d=new ResizeObserver(()=>{c=requestAnimationFrame(()=>{let c=a.offsetHeight;b.style.setProperty("--cmdk-list-height",c.toFixed(1)+"px")})});return d.observe(a),()=>{cancelAnimationFrame(c),d.unobserve(a)}}},[]),c.createElement(R.Primitive.div,{ref:an([g,b]),...f,"cmdk-list":"",role:"listbox","aria-label":e,id:i.listId},ar(a,a=>c.createElement("div",{ref:an([h,i.listInnerRef]),"cmdk-list-sizer":""},a)))}),ai=c.forwardRef((a,b)=>{let{open:d,onOpenChange:e,overlayClassName:f,contentClassName:g,container:h,...i}=a;return c.createElement(Q.Root,{open:d,onOpenChange:e},c.createElement(Q.Portal,{container:h},c.createElement(Q.Overlay,{"cmdk-overlay":"",className:f}),c.createElement(Q.Content,{"aria-label":a.label,"cmdk-dialog":"",className:g},c.createElement(ac,{ref:b,...i}))))}),aj=Object.assign(ac,{List:ah,Item:ad,Input:ag,Group:ae,Separator:af,Dialog:ai,Empty:c.forwardRef((a,b)=>ao(a=>0===a.filtered.count)?c.createElement(R.Primitive.div,{ref:b,...a,"cmdk-empty":"",role:"presentation"}):null),Loading:c.forwardRef((a,b)=>{let{progress:d,children:e,label:f="Loading...",...g}=a;return c.createElement(R.Primitive.div,{ref:b,...g,"cmdk-loading":"",role:"progressbar","aria-valuenow":d,"aria-valuemin":0,"aria-valuemax":100,"aria-label":f},ar(a,a=>c.createElement("div",{"aria-hidden":!0},a)))})});function ak(a){let b=c.useRef(a);return al(()=>{b.current=a}),b}var al=c.useEffect;function am(a){let b=c.useRef();return void 0===b.current&&(b.current=a()),b}function an(a){return b=>{a.forEach(a=>{"function"==typeof a?a(b):null!=a&&(a.current=b)})}}function ao(a){let b=c.useContext(aa),d=()=>a(b.snapshot());return(0,T.useSyncExternalStore)(b.subscribe,d,d)}function ap(a,b,d,e=[]){let f=c.useRef(),g=c.useContext(_);return al(()=>{var c;let h=(()=>{var a;for(let b of d){if("string"==typeof b)return b.trim();if("object"==typeof b&&"current"in b)return b.current?null==(a=b.current.textContent)?void 0:a.trim():f.current}})(),i=e.map(a=>a.trim());g.value(a,h,i),null==(c=b.current)||c.setAttribute(Z,h),f.current=h}),f}var aq=()=>{let[a,b]=c.useState(),d=am(()=>new Map);return al(()=>{d.current.forEach(a=>a()),d.current=new Map},[a]),(a,c)=>{d.current.set(a,c),b({})}};function ar({asChild:a,children:b},d){let e;return a&&c.isValidElement(b)?c.cloneElement("function"==typeof(e=b.type)?e(b.props):"render"in e?e.render(b.props):b,{ref:b.ref},d(b.props.children)):d(b)}var as={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"},at=a.i(50537),at=at,au=a.i(97895);function av({className:a,...c}){return(0,b.jsx)(aj,{"data-slot":"command",className:(0,au.cn)("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",a),...c})}function aw({className:a,...c}){return(0,b.jsxs)("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[(0,b.jsx)(at.default,{className:"size-4 shrink-0 opacity-50"}),(0,b.jsx)(aj.Input,{"data-slot":"command-input",className:(0,au.cn)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",a),...c})]})}function ax({className:a,...c}){return(0,b.jsx)(aj.List,{"data-slot":"command-list",className:(0,au.cn)("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",a),...c})}function ay({...a}){return(0,b.jsx)(aj.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...a})}function az({className:a,...c}){return(0,b.jsx)(aj.Group,{"data-slot":"command-group",className:(0,au.cn)("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",a),...c})}function aA({className:a,...c}){return(0,b.jsx)(aj.Item,{"data-slot":"command-item",className:(0,au.cn)("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",a),...c})}var aB=a.i(30342),aC=a.i(33441);function aD({open:a,onClose:d,preSelectedStageId:e,preSelectedPlayer:i,onDealCreated:j}){let[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)([]),[o,q]=(0,c.useState)([]),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),[B,C]=(0,c.useState)({player_name:"",programme_id:""}),{toast:L}=(0,p.useToast)();(0,c.useEffect)(()=>{a&&(M(),N(),P())},[a]),(0,c.useEffect)(()=>{z.programme_id&&O(z.programme_id)},[z.programme_id]),(0,c.useEffect)(()=>{e&&r.length>0&&r.find(a=>a.id===e)&&A(a=>({...a,stage_id:e.toString()}))},[e,r]),(0,c.useEffect)(()=>{i&&A(a=>({...a,player_id:i.id,player_name:i.name}))},[i]);let M=async()=>{n([{id:1,name:"John Smith",email:"john.smith@example.com"},{id:2,name:"Emma Johnson",email:"emma.j@example.com"},{id:3,name:"Michael Chen",email:"m.chen@example.com"}])},N=async()=>{q([{id:1,name:"Youth Academy"},{id:2,name:"Elite Training"},{id:3,name:"Summer Camp"}])},O=async a=>{s([{id:1,name:"New Lead"},{id:2,name:"Contacted"},{id:3,name:"Trial Scheduled"},{id:4,name:"Offer Sent"},{id:5,name:"Signed"}]),z.stage_id||A(a=>({...a,stage_id:"1"}))},P=async()=>{u([{id:1,name:"Sarah Wilson"},{id:2,name:"Mike Thompson"},{id:3,name:"David Brown"}])},Q=async a=>{let b;a.preventDefault(),b={player_name:"",programme_id:""},z.player_name||(b.player_name="Player name is required"),z.programme_id||(b.programme_id="Programme is required"),C(b),b.player_name||b.programme_id||(l(!0),setTimeout(()=>{let a=t.find(a=>a.id.toString()===z.recruiter_id),b=o.find(a=>a.id.toString()===z.programme_id),c=r.find(a=>a.id.toString()===z.stage_id),e={id:Math.floor(1e3*Math.random()),player_name:z.player_name,email:i?.email||"player@example.com",phone:i?.phone||"+44 7700 900000",programme:b?.name||"Youth Academy",recruiter:a?.name||"Sarah Wilson",status:"active",last_activity:new Date().toISOString(),stage_id:parseInt(z.stage_id),stage_name:c?.name||"New Lead",recruiter_id:z.recruiter_id?parseInt(z.recruiter_id):1,program_id:parseInt(z.programme_id),deal_value:z.deal_value?parseFloat(z.deal_value):0,notes:z.notes,pipeline_id:z.programme_id};L({title:"Deal created",description:`${z.player_name} has been added to the pipeline.`}),A({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),j&&j(e),d(),l(!1)},1e3))};return(0,b.jsx)(v.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(v.DialogContent,{className:"sm:max-w-[500px] bg-white shadow-xl",children:[(0,b.jsxs)(v.DialogHeader,{className:"border-b pb-4",children:[(0,b.jsx)(v.DialogTitle,{className:"text-xl font-semibold text-gray-900",children:"Create New Deal"}),(0,b.jsx)(v.DialogDescription,{className:"text-sm text-gray-500",children:"Add a new player to your recruitment pipeline"})]}),(0,b.jsxs)("form",{onSubmit:Q,className:"space-y-5 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"player_name",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(F.User,{className:"h-4 w-4 text-blue-600"}),"Player Name ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(aB.Popover,{open:x,onOpenChange:y,children:[(0,b.jsx)(aB.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",role:"combobox","aria-expanded":x,className:(0,au.cn)("w-full justify-between",!z.player_name&&"text-muted-foreground",B.player_name&&"border-red-500 focus:ring-red-500"),children:[z.player_name||"Select or type player name...",(0,b.jsx)(aC.Check,{className:(0,au.cn)("ml-2 h-4 w-4",z.player_name?"opacity-100":"opacity-0")})]})}),(0,b.jsx)(aB.PopoverContent,{className:"w-[460px] p-0",children:(0,b.jsxs)(av,{children:[(0,b.jsx)(aw,{placeholder:"Search players...",value:z.player_name,onValueChange:a=>{A(b=>({...b,player_name:a,player_id:""})),C(a=>({...a,player_name:""}))}}),(0,b.jsxs)(ax,{children:[(0,b.jsx)(ay,{children:"No player found. Keep typing to add new player."}),(0,b.jsx)(az,{children:m.map(a=>(0,b.jsxs)(aA,{value:a.name,onSelect:()=>{A(b=>({...b,player_id:a.id.toString(),player_name:a.name})),C(a=>({...a,player_name:""})),y(!1)},children:[(0,b.jsx)(aC.Check,{className:(0,au.cn)("mr-2 h-4 w-4",z.player_id===a.id.toString()?"opacity-100":"opacity-0")}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.email})]})]},a.id))})]})]})})]}),B.player_name&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:B.player_name})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"programme",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(G.GraduationCap,{className:"h-4 w-4 text-purple-600"}),"Programme ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(f.Select,{value:z.programme_id,onValueChange:a=>{A(b=>({...b,programme_id:a,stage_id:""})),C(a=>({...a,programme_id:""}))},children:[(0,b.jsx)(f.SelectTrigger,{className:(0,au.cn)("w-full",B.programme_id&&"border-red-500 focus:ring-red-500"),children:(0,b.jsx)(f.SelectValue,{placeholder:"Select programme"})}),(0,b.jsx)(f.SelectContent,{children:o.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]}),B.programme_id&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:B.programme_id})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"stage",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(H,{className:"h-4 w-4 text-green-600"}),"Stage"]}),(0,b.jsxs)(f.Select,{value:z.stage_id,onValueChange:a=>A(b=>({...b,stage_id:a})),disabled:!z.programme_id,children:[(0,b.jsx)(f.SelectTrigger,{className:"w-full",children:(0,b.jsx)(f.SelectValue,{placeholder:z.programme_id?"Select stage":"Select programme first"})}),(0,b.jsx)(f.SelectContent,{children:r.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"recruiter",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(I.UserCircle2,{className:"h-4 w-4 text-blue-600"}),"Assigned Recruiter"]}),(0,b.jsxs)(f.Select,{value:z.recruiter_id,onValueChange:a=>A(b=>({...b,recruiter_id:a})),children:[(0,b.jsx)(f.SelectTrigger,{className:"w-full",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select recruiter"})}),(0,b.jsx)(f.SelectContent,{children:t.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"deal_value",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(J.DollarSign,{className:"h-4 w-4 text-green-600"}),"Deal Value (£)"]}),(0,b.jsx)(h.Input,{id:"deal_value",type:"number",placeholder:"0.00",value:z.deal_value,onChange:a=>A(b=>({...b,deal_value:a.target.value})),className:"focus:border-blue-500 focus:ring-blue-500"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"notes",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(K.FileText,{className:"h-4 w-4 text-gray-600"}),"Notes"]}),(0,b.jsx)(D.Textarea,{id:"notes",placeholder:"Add any additional notes...",value:z.notes,onChange:a=>A(b=>({...b,notes:a.target.value})),className:"resize-none focus:border-blue-500 focus:ring-blue-500",rows:3})]}),(0,b.jsxs)(v.DialogFooter,{className:"gap-2 pt-4 border-t",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:()=>{A({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),C({player_name:"",programme_id:""}),d()},disabled:k,className:"hover:bg-gray-100 bg-transparent",children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",disabled:k,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Deal"})]})]})]})})}let aE=(0,q.default)("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),aF=(0,q.default)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),aG=[{name:"Teal",value:"bg-teal-500",hex:"#14b8a6"},{name:"Sky Blue",value:"bg-sky-500",hex:"#0ea5e9"},{name:"Purple",value:"bg-purple-500",hex:"#a855f7"},{name:"Green",value:"bg-green-500",hex:"#22c55e"},{name:"Orange",value:"bg-orange-500",hex:"#f97316"},{name:"Pink",value:"bg-pink-500",hex:"#ec4899"},{name:"Indigo",value:"bg-indigo-500",hex:"#6366f1"},{name:"Yellow",value:"bg-yellow-500",hex:"#eab308"}];function aH({open:a,onClose:d}){let[e,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(""),[q,r]=(0,c.useState)({name:"",color:"",order:""}),[s,t]=(0,c.useState)({name:"",pipeline:""}),{toast:u}=(0,p.useToast)();(0,c.useEffect)(()=>{a&&x()},[a]),(0,c.useEffect)(()=>{n&&y(n)},[n]);let x=async()=>{try{let a=await fetch("/api/pipelines"),b=await a.json();k(b),b.length>0&&o(b[0].id.toString())}catch(a){console.error("Failed to fetch pipelines:",a)}},y=async a=>{try{let b=await fetch(`/api/pipelines/${a}/stages?stagesOnly=true`),c=await b.json();if(m(c||[]),!q.color&&c&&c.length>0){let a=c.length%aG.length;r(b=>({...b,color:aG[a].hex}))}c&&c.length>0&&!q.order?r(a=>({...a,order:(c.length+1).toString()})):q.order||r(a=>({...a,order:"1"}))}catch(a){console.error("Failed to fetch stages:",a)}},z=async a=>{let b;if(a.preventDefault(),b={name:"",pipeline:""},q.name.trim()||(b.name="Stage name is required"),n||(b.pipeline="Pipeline is required"),t(b),!b.name&&!b.pipeline){i(!0);try{let a=await fetch("/api/stages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pipeline_id:n,name:q.name.trim(),color:q.color||aG[0].hex,order:q.order?Number.parseInt(q.order):l.length+1})});if(a.ok)u({title:"Stage added successfully",description:`${q.name} has been added to the pipeline.`}),r({name:"",color:"",order:""}),window.dispatchEvent(new CustomEvent("stageCreated")),d();else{let b=await a.json();u({title:"Failed to add stage",description:b.error||"Please try again.",variant:"destructive"})}}catch(a){console.error("Error adding stage:",a),u({title:"Failed to add stage",description:"An unexpected error occurred.",variant:"destructive"})}finally{i(!1)}}};return(0,b.jsx)(v.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(v.DialogContent,{className:"sm:max-w-[500px] bg-white shadow-xl",children:[(0,b.jsxs)(v.DialogHeader,{className:"border-b pb-4",children:[(0,b.jsx)(v.DialogTitle,{className:"text-xl font-semibold text-gray-900",children:"Add New Stage"}),(0,b.jsx)(v.DialogDescription,{className:"text-sm text-gray-500",children:"Add a new stage to your recruitment pipeline"})]}),(0,b.jsxs)("form",{onSubmit:z,className:"space-y-5 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"pipeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(H,{className:"h-4 w-4 text-blue-600"}),"Pipeline ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)(f.Select,{value:n,onValueChange:o,children:[(0,b.jsx)(f.SelectTrigger,{className:"w-full",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select pipeline"})}),(0,b.jsx)(f.SelectContent,{children:j.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]}),s.pipeline&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:s.pipeline})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"name",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(H,{className:"h-4 w-4 text-purple-600"}),"Stage Name ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(h.Input,{id:"name",placeholder:"e.g., Initial Contact, Interview Scheduled",value:q.name,onChange:a=>{r(b=>({...b,name:a.target.value})),t(a=>({...a,name:""}))},className:s.name?"border-red-500 focus:ring-red-500":"focus:border-blue-500 focus:ring-blue-500"}),s.name&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:s.name})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"color",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(aE,{className:"h-4 w-4 text-pink-600"}),"Color (optional)"]}),(0,b.jsx)("div",{className:"grid grid-cols-4 gap-2",children:aG.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>r(b=>({...b,color:a.hex})),className:`flex items-center gap-2 p-2 rounded-lg border-2 transition-all ${q.color===a.hex?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,b.jsx)("div",{className:`w-6 h-6 rounded ${a.value}`}),(0,b.jsx)("span",{className:"text-xs font-medium",children:a.name})]},a.hex))}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:q.color?"Selected color will be used for this stage":"A color will be auto-assigned"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(w.Label,{htmlFor:"order",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,b.jsx)(aF,{className:"h-4 w-4 text-green-600"}),"Order Position (optional)"]}),(0,b.jsx)(h.Input,{id:"order",type:"number",min:"1",max:l.length+1,placeholder:`Position (1-${l.length+1})`,value:q.order,onChange:a=>r(b=>({...b,order:a.target.value})),className:"focus:border-blue-500 focus:ring-blue-500"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Leave empty to add at the end. Current stages: ",l.length]})]}),(0,b.jsxs)(v.DialogFooter,{className:"gap-2 pt-4 border-t",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:()=>{r({name:"",color:"",order:""}),t({name:"",pipeline:""}),d()},disabled:e,className:"hover:bg-gray-100 bg-transparent",children:"Cancel"}),(0,b.jsx)(g.Button,{type:"submit",disabled:e,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg",children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Stage"})]})]})]})})}var aI=a.i(21958),aJ=a.i(54161),aK=a.i(92258),aL=a.i(63519),aM=a.i(52495),aN=a.i(92759),aO=a.i(41675),aP=a.i(33508),aQ=a.i(11156),aR=a.i(67453),aS=a.i(92e3),aT=a.i(90669),aU=a.i(38246);function aV({deal:a,open:d,onClose:e,stages:k,pipelineId:l,onDealUpdated:m}){let[n,o]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),[s,u]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(""),[E,F]=(0,c.useState)([]),[H,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!1),{toast:O}=(0,p.useToast)();(0,c.useEffect)(()=>{a&&d&&(r(a.recruiter_id||null),u(a.deal_value?.toString()||""),y(a.notes||""),A(a.stage_id||null),C(a.next_follow_up||""),P())},[a,d]);let P=async()=>{let a=await fetch("/api/settings/recruiters"),b=await a.json();F(Array.isArray(b)?b:b.data||[])},Q=async b=>{if(!a||H)return;L(!0);let c=Number.parseInt(b);try{if((await fetch(`/api/deals/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage_id:c})})).ok){A(c);let b=k.find(a=>a.id===c)?.name||"";O({title:"Stage updated",description:`Deal moved to ${b}`}),m&&m({...a,stage_id:c,stage_name:b})}else O({title:"Error",description:"Failed to update stage",variant:"destructive"}),A(a.stage_id||null)}catch(b){O({title:"Error",description:"Failed to update stage",variant:"destructive"}),A(a.stage_id||null)}finally{L(!1)}},R=async b=>{if(a&&!M){C(b),N(!0);try{(await fetch(`/api/deals/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({next_follow_up:b})})).ok||(O({title:"Error",description:"Failed to save follow-up date",variant:"destructive"}),C(a.next_follow_up||""))}catch(b){O({title:"Error",description:"Failed to save follow-up date",variant:"destructive"}),C(a.next_follow_up||"")}finally{N(!1)}}},S=async()=>{if(a)try{if((await fetch(`/api/deals/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({recruiter_id:q,deal_value:s?Number.parseFloat(s):void 0,notes:x})})).ok){let b=E.find(a=>a.id===q)?.full_name||E.find(a=>a.id===q)?.name||a.recruiter;O({title:"Deal updated",description:"Changes saved successfully"}),o(!1),m&&m({...a,recruiter_id:q||a.recruiter_id,recruiter:b,deal_value:s?Number.parseFloat(s):a.deal_value,notes:x})}else O({title:"Error",description:"Failed to save changes",variant:"destructive"})}catch(a){O({title:"Error",description:"Failed to save changes",variant:"destructive"})}};if(!a)return null;let T=k.find(a=>a.id===z)?.name||a.stage_name||"Unknown Stage";return(0,b.jsx)(v.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(v.DialogContent,{className:"max-w-2xl max-h-[90vh] my-4 overflow-hidden p-0 flex flex-col",children:[(0,b.jsx)(v.DialogHeader,{className:"border-b pb-4 bg-white -mx-6 -mt-6 px-6 pt-6 mb-6",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg flex-shrink-0 shadow-md",children:a.player_name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)(v.DialogTitle,{className:"text-xl font-semibold text-gray-900 mb-2",children:a.player_name}),(0,b.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,b.jsx)(aJ.Badge,{className:"bg-blue-100 text-blue-700 border-blue-200 border font-medium transition-all duration-200",children:T})}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Recruiter: ",a.recruiter]})]})]})}),(0,b.jsxs)(aI.Tabs,{defaultValue:"overview",className:"space-y-6",children:[(0,b.jsxs)(aI.TabsList,{className:"grid w-full grid-cols-3 bg-white shadow-sm",children:[(0,b.jsx)(aI.TabsTrigger,{value:"overview",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Overview"}),(0,b.jsx)(aI.TabsTrigger,{value:"invoices",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Invoices"}),(0,b.jsx)(aI.TabsTrigger,{value:"activity",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Activity"})]}),(0,b.jsxs)(aI.TabsContent,{value:"overview",className:"space-y-6 animate-fade-in",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(w.Label,{className:"text-sm font-medium text-gray-700",children:"Change Stage"})}),!n&&(0,b.jsxs)(g.Button,{variant:"ghost",size:"sm",onClick:()=>o(!0),className:"text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[(0,b.jsx)(t.Edit,{className:"h-4 w-4 mr-1"}),"Edit"]})]}),(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white mb-4",children:[(0,b.jsxs)(f.Select,{value:z?.toString()||"",onValueChange:Q,disabled:H,children:[(0,b.jsx)(f.SelectTrigger,{className:"w-full",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select stage"})}),(0,b.jsx)(f.SelectContent,{children:k.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))})]}),H&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Saving..."})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(aK.Mail,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Email"}),(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm truncate",children:a.email})]})]})}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(aL.Phone,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Phone"}),(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:a.phone})]})]})}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(G.GraduationCap,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Programme"}),(0,b.jsx)(aJ.Badge,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white border-0 text-xs",children:a.programme})]})]})}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(I.UserCircle2,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Recruiter"}),n?(0,b.jsxs)(f.Select,{value:q?.toString()||"",onValueChange:a=>r(Number.parseInt(a)),children:[(0,b.jsx)(f.SelectTrigger,{className:"h-8 text-sm",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select recruiter"})}),(0,b.jsx)(f.SelectContent,{children:E.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.full_name||a.name},a.id))})]}):(0,b.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:a.recruiter})]})]})})]}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(J.DollarSign,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(w.Label,{htmlFor:"deal-value",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Deal Value"}),n?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"£"}),(0,b.jsx)(h.Input,{id:"deal-value",type:"number",value:s,onChange:a=>u(a.target.value),placeholder:"0",className:"pl-8"})]}):(0,b.jsxs)("p",{className:"text-lg font-bold text-green-600",children:["£",a.deal_value?.toLocaleString()||"0"]})]})]})}),n&&(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,b.jsx)(w.Label,{htmlFor:"notes",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Notes"}),(0,b.jsx)(D.Textarea,{id:"notes",value:x,onChange:a=>y(a.target.value),placeholder:"Add notes about this deal...",rows:4,className:"resize-none"})]}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(j.Clock,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Last Contacted"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,b.jsx)("span",{children:"2 days ago"}),(0,b.jsx)("span",{className:"text-gray-400",children:"•"}),(0,b.jsx)(aJ.Badge,{variant:"outline",className:"text-xs",children:"Email"})]})]})]})}),(0,b.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(aO.Calendar,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(w.Label,{htmlFor:"next-followup",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Next Follow-Up"}),(0,b.jsx)(h.Input,{id:"next-followup",type:"date",value:B,onChange:a=>R(a.target.value),className:"focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200",disabled:M}),M&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Saving..."})]})]})}),n&&(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(g.Button,{onClick:S,className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:"Save Changes"}),(0,b.jsxs)(g.Button,{onClick:()=>{r(a?.recruiter_id||null),u(a?.deal_value?.toString()||""),y(a?.notes||""),o(!1)},variant:"outline",className:"flex-1 bg-transparent",children:[(0,b.jsx)(aP.X,{className:"mr-2 h-4 w-4"}),"Cancel"]})]}),!n&&(0,b.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,b.jsxs)(g.Button,{className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-200",size:"lg",children:[(0,b.jsx)(aN.Send,{className:"mr-2 h-4 w-4"}),"Send Message"]}),(0,b.jsx)(aU.default,{href:"/pipelines",className:"block",children:(0,b.jsxs)(g.Button,{variant:"outline",className:"w-full border-2 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-700 transition-all duration-200 bg-transparent",size:"lg",children:["View in Pipeline",(0,b.jsx)(aM.ExternalLink,{className:"ml-2 h-4 w-4"})]})})]})]}),(0,b.jsxs)(aI.TabsContent,{value:"invoices",className:"animate-fade-in space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-blue-50 flex items-center justify-center",children:(0,b.jsx)(K.FileText,{className:"h-5 w-5 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-001"}),(0,b.jsxs)(aJ.Badge,{className:"bg-green-100 text-green-700 hover:bg-green-100",children:[(0,b.jsx)(aR.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Paid"]})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Registration Fee - ",a?.programme||"Program"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Issued: Jan 15, 2024 • Due: Jan 30, 2024"})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"font-bold text-lg",children:["£",a?.deal_value||"18,000"]})})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{O({title:"Downloading Invoice",description:"Invoice #INV-2024-001 is being downloaded..."})},children:[(0,b.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[(0,b.jsx)(aQ.CreditCard,{className:"h-4 w-4 mr-2"}),"Paid"]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-amber-50 flex items-center justify-center",children:(0,b.jsx)(K.FileText,{className:"h-5 w-5 text-amber-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-002"}),(0,b.jsxs)(aJ.Badge,{className:"bg-amber-100 text-amber-700 hover:bg-amber-100",children:[(0,b.jsx)(aS.AlertCircle,{className:"h-3 w-3 mr-1"}),"Pending"]})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Program Deposit - ",a?.programme||"Program"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Issued: Feb 01, 2024 • Due: Feb 15, 2024"})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("p",{className:"font-bold text-lg",children:"£5,000"})})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{O({title:"Downloading Invoice",description:"Invoice #INV-2024-002 is being downloaded..."})},children:[(0,b.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,b.jsxs)(g.Button,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:()=>{O({title:"Opening Payment Portal",description:"Redirecting to Stripe payment page..."})},children:[(0,b.jsx)(aQ.CreditCard,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]}),(0,b.jsxs)("div",{className:"border border-red-200 rounded-lg p-4 hover:border-red-400 transition-colors bg-red-50/30",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-red-100 flex items-center justify-center",children:(0,b.jsx)(K.FileText,{className:"h-5 w-5 text-red-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-003"}),(0,b.jsxs)(aJ.Badge,{className:"bg-red-100 text-red-700 hover:bg-red-100",children:[(0,b.jsx)(aS.AlertCircle,{className:"h-3 w-3 mr-1"}),"Overdue"]})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Monthly Fee - ",a?.programme||"Program"]}),(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1 font-medium",children:"Issued: Dec 01, 2023 • Due: Dec 15, 2023"})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("p",{className:"font-bold text-lg text-red-600",children:"£2,500"})})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{O({title:"Downloading Invoice",description:"Invoice #INV-2024-003 is being downloaded..."})},children:[(0,b.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,b.jsxs)(g.Button,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:()=>{O({title:"Opening Payment Portal",description:"Redirecting to Stripe payment page..."})},children:[(0,b.jsx)(aQ.CreditCard,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]})]}),(0,b.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total Invoiced"}),(0,b.jsxs)("span",{className:"font-semibold",children:["£",(parseFloat(a?.deal_value?.toString()||"18000")+7500).toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total Paid"}),(0,b.jsxs)("span",{className:"font-semibold text-green-600",children:["£",a?.deal_value||"18,000"]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Outstanding"}),(0,b.jsx)("span",{className:"font-semibold text-red-600",children:"£7,500"})]})]})]}),(0,b.jsx)(aI.TabsContent,{value:"activity",className:"animate-fade-in",children:(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"relative space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,b.jsx)(aT.Activity,{className:"h-4 w-4 text-blue-600"})}),(0,b.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Stage updated"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Moved to ",(0,b.jsx)("span",{className:"font-semibold",children:a?.stage_name||"Zoom Scheduled"})]})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"2 hours ago"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",a?.recruiter||"Sarah"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:(0,b.jsx)(aK.Mail,{className:"h-4 w-4 text-green-600"})}),(0,b.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Email sent"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Follow-up email sent to player"})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"5 hours ago"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",a?.recruiter||"Sarah"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-purple-100 flex items-center justify-center",children:(0,b.jsx)(K.FileText,{className:"h-4 w-4 text-purple-600"})}),(0,b.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Note added"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a?.notes||"Player expressed strong interest in the program. Follow-up scheduled for next week."})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"1 day ago"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",a?.recruiter||"Sarah"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-amber-100 flex items-center justify-center",children:(0,b.jsx)(aL.Phone,{className:"h-4 w-4 text-amber-600"})}),(0,b.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Phone call"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Outbound call - 15 minutes"})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"2 days ago"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",a?.recruiter||"Sarah"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:(0,b.jsx)(aR.CheckCircle2,{className:"h-4 w-4 text-green-600"})}),(0,b.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,b.jsxs)("div",{className:"flex-1 pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Payment received"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Invoice #INV-2024-001 paid - £",a?.deal_value||"18,000"]})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"3 days ago"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"via Stripe"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("div",{className:"flex flex-col items-center",children:(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center",children:(0,b.jsx)(I.UserCircle2,{className:"h-4 w-4 text-gray-600"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Deal created"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Player added to pipeline"})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"1 week ago"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",a?.recruiter||"Sarah"]})]})]})]})})})]})]})})}function aW(){var a;let e=(0,d.useSearchParams)(),m=e.get("pipelineId"),n=e.get("dealId"),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(m||""),[u,v]=(0,c.useState)("all"),[w,x]=(0,c.useState)({from:null,to:null}),[y,z]=(0,c.useState)("newest"),[A,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)("all"),[O,P]=(0,c.useState)("all"),[Q,R]=(0,c.useState)("all"),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(!1),aa=async()=>{let a=await fetch("/api/pipelines"),b=await a.json();p(b),b.length>0&&!s&&t(b[0].id.toString())};(0,c.useEffect)(()=>{aa()},[]),(0,c.useEffect)(()=>{m&&t(m)},[m]),(0,c.useEffect)(()=>{if(n&&A){let a=null;for(let b of A.stages){let c=b.deals.find(a=>a.id.toString()===n);if(c){a=c;break}}a&&(F(a),H(!0))}},[n,A]),(0,c.useEffect)(()=>{fetch("/api/settings/recruiters").then(a=>a.json()).then(a=>r(a))},[]),(0,c.useEffect)(()=>{s&&(J(!0),fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>{D(a),J(!1)}))},[s]),(0,c.useEffect)(()=>{let a=a=>{let b=a.detail;b&&A?D(a=>a?{...a,stages:a.stages.map(a=>a.id===b.stage_id?{...a,deals:[...a.deals,b]}:a)}:a):s&&fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>D(a))};return window.addEventListener("dealCreated",a),()=>window.removeEventListener("dealCreated",a)},[s,A]),(0,c.useEffect)(()=>{let a=()=>{s&&fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>D(a))};return window.addEventListener("stageCreated",a),()=>window.removeEventListener("stageCreated",a)},[s]),(0,c.useEffect)(()=>{let a=()=>{s&&fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>D(a))};return window.addEventListener("stageDeleted",a),()=>window.removeEventListener("stageDeleted",a)},[s]);let ab=async(a,b)=>{try{if((await fetch(`/api/deals/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage_id:b})})).ok&&s){let a=await fetch(`/api/pipelines/${s}/stages`).then(a=>a.json());D(a)}}catch(a){console.error("Failed to update deal:",a)}},ac=async(a,b,c,d)=>{try{if((await fetch(`/api/pipelines/${s}/stages/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b,color:c,order:d})})).ok){let a=await fetch(`/api/pipelines/${s}/stages`).then(a=>a.json());D(a)}}catch(a){console.error("Failed to update stage:",a)}},ad=A?{...A,stages:A.stages.map(a=>{let b=a.deals;K&&(b=b.filter(a=>a.player_name.toLowerCase().includes(K.toLowerCase()))),"all"!==u&&(b=b.filter(a=>a.recruiter===q.find(a=>a.id.toString()===u)?.name)),(w.from||w.to)&&(b=b.filter(a=>{let b=new Date(a.last_activity);return(!w.from||!(b<w.from))&&(!w.to||!(b>w.to))}));let c=[...b].sort((a,b)=>"newest"===y?new Date(b.last_activity).getTime()-new Date(a.last_activity).getTime():"value"===y?(b.deal_value||0)-(a.deal_value||0):"recruiter"===y?a.recruiter.localeCompare(b.recruiter):0);return{...a,deals:c}})}:null,ae=ad?ad.stages.reduce((a,b)=>a+b.deals.length,0):0,af=ad?ad.stages.reduce((a,b)=>a+b.deals.reduce((a,b)=>a+(b.deal_value||0),0),0):0;return(0,b.jsxs)("div",{className:"flex flex-col h-full",children:[(0,b.jsxs)("div",{className:"flex-shrink-0 space-y-4 pb-4",children:[(0,b.jsx)("div",{className:"rounded-lg border border-border bg-card p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(aB.Popover,{open:U,onOpenChange:V,children:[(0,b.jsx)(aB.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"gap-2 text-muted-foreground hover:bg-muted hover:border-primary transition-colors bg-transparent",children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Add a filter"]})}),(0,b.jsx)(aB.PopoverContent,{className:"w-56 p-3",align:"start",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"font-medium text-sm text-foreground mb-3",children:"Available Filters"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{V(!1)},children:"Deal owner"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{V(!1)},children:"Status"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{V(!1)},children:"Tags"}),(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{V(!1)},children:"Recruiter"})]})})]}),(0,b.jsxs)(f.Select,{value:M,onValueChange:N,children:[(0,b.jsx)(f.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,b.jsx)(f.SelectValue,{placeholder:"All owners"})}),(0,b.jsxs)(f.SelectContent,{children:[(0,b.jsx)(f.SelectItem,{value:"all",children:"All owners"}),q.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))]})]}),(0,b.jsxs)(f.Select,{value:O,onValueChange:P,children:[(0,b.jsx)(f.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,b.jsx)(f.SelectValue,{placeholder:"All statuses"})}),(0,b.jsxs)(f.SelectContent,{children:[(0,b.jsx)(f.SelectItem,{value:"all",children:"All statuses"}),(0,b.jsx)(f.SelectItem,{value:"in-pipeline",children:"In Pipeline"}),(0,b.jsx)(f.SelectItem,{value:"contacted",children:"Contacted"}),(0,b.jsx)(f.SelectItem,{value:"signed",children:"Signed"})]})]}),(0,b.jsxs)(f.Select,{value:Q,onValueChange:R,children:[(0,b.jsx)(f.SelectTrigger,{className:"h-9 w-[120px] border-border hover:border-primary focus:border-primary transition-colors",children:(0,b.jsx)(f.SelectValue,{placeholder:"All tags"})}),(0,b.jsxs)(f.SelectContent,{children:[(0,b.jsx)(f.SelectItem,{value:"all",children:"All tags"}),(0,b.jsx)(f.SelectItem,{value:"high-priority",children:"High Priority"}),(0,b.jsx)(f.SelectItem,{value:"follow-up",children:"Follow Up"})]})]}),(0,b.jsxs)(f.Select,{value:u,onValueChange:v,children:[(0,b.jsx)(f.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,b.jsx)(f.SelectValue,{placeholder:"All recruiters"})}),(0,b.jsxs)(f.SelectContent,{children:[(0,b.jsx)(f.SelectItem,{value:"all",children:"All recruiters"}),q.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative w-[240px]",children:[(0,b.jsx)(l.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(h.Input,{placeholder:"Search deals",value:K,onChange:a=>L(a.target.value),className:"h-9 pl-10 border-border hover:border-primary focus:border-primary transition-colors"})]}),(0,b.jsxs)(f.Select,{value:s,onValueChange:t,children:[(0,b.jsx)(f.SelectTrigger,{className:"h-9 w-[260px] border-border hover:border-primary transition-colors font-medium",children:(0,b.jsx)(f.SelectValue,{placeholder:"Select pipeline"})}),(0,b.jsxs)(f.SelectContent,{className:"w-[260px]",children:[(0,b.jsx)("div",{className:"px-2 pb-2 pt-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(l.Search,{className:"absolute left-2 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(h.Input,{placeholder:"Search pipelines...",className:"h-8 pl-8 text-sm border-border focus:border-primary"})]})}),(0,b.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:o.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id.toString(),className:"cursor-pointer px-3 py-2.5",children:(0,b.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,b.jsx)("span",{className:"text-[15px] font-medium text-foreground",children:a.name}),void 0!==a.dealCount&&(0,b.jsxs)("span",{className:"text-[13px] text-muted-foreground ml-2",children:["(",a.dealCount,")"]})]})},a.id))}),(0,b.jsx)("div",{className:"my-1 mx-2",children:(0,b.jsx)("div",{className:"h-px bg-border"})}),(0,b.jsxs)("button",{type:"button",onClick:a=>{a.preventDefault(),T(!0)},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-3 py-2.5 text-[15px] font-medium text-primary hover:bg-accent outline-none transition-colors",children:[(0,b.jsx)(k.Plus,{className:"mr-2 h-4 w-4"}),"Add a pipeline"]})]})]})]})]})}),ad&&(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-border bg-muted/30 px-6 py-3 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Total players:"}),(0,b.jsx)("span",{className:"text-lg font-bold text-primary",children:ae})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Total value:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-success",children:["£",af.toLocaleString()]})]}),void 0!==ad.dealsWon&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Deals won:"}),(0,b.jsx)("span",{className:"text-lg font-bold text-primary",children:ad.dealsWon})]}),void 0!==ad.conversionRate&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Conversion rate:"}),(0,b.jsxs)("span",{className:"text-lg font-bold text-success",children:[ad.conversionRate.toFixed(1),"%"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(j.Clock,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Last updated: ",(a=new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" at "+a.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]})]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",className:"gap-2 bg-card transition-all duration-200 hover:bg-muted hover:shadow-md",children:[(0,b.jsx)(i.Download,{className:"h-4 w-4"}),"Export CSV"]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",children:I?(0,b.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Loading pipeline..."})}):ad?0===ad.stages.length?(0,b.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,b.jsx)("div",{className:"text-center space-y-4",children:(0,b.jsxs)("div",{className:"rounded-lg bg-muted/50 border border-border p-8 max-w-md mx-auto",children:[(0,b.jsx)("p",{className:"text-base font-medium text-foreground mb-2",children:"No stages yet — create your first one"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Add stages to organize your deals through the recruitment process."}),(0,b.jsxs)(g.Button,{onClick:()=>_(!0),className:"gradient-primary",children:[(0,b.jsx)(k.Plus,{className:"mr-2 h-4 w-4"}),"Add Stage"]})]})})}):(0,b.jsx)(B,{pipelineData:ad,onDealClick:a=>{F(a),H(!0)},onDealMove:ab,onStageEdit:ac,onAddDeal:a=>{Z(a),X(!0)}}):(0,b.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Select a pipeline to view deals"})})}),E&&ad&&(0,b.jsx)(aV,{deal:E,open:G,onClose:()=>H(!1),stages:ad.stages.map(a=>({id:a.id,name:a.name})),pipelineId:Number.parseInt(s),onDealUpdated:a=>{A&&D({...A,stages:A.stages.map(b=>({...b,deals:b.deals.map(b=>b.id===a.id?{...b,...a}:b)}))}),s&&fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>D(a))}}),(0,b.jsx)(C,{open:S,onClose:()=>T(!1),onSuccess:()=>{aa()}}),(0,b.jsx)(aD,{open:W,onClose:()=>{X(!1),Z(null)},preSelectedStageId:Y,onDealCreated:a=>{A&&a.stage_id&&D({...A,stages:A.stages.map(b=>b.id===a.stage_id?{...b,deals:[...b.deals,a]}:b)}),s&&fetch(`/api/pipelines/${s}/stages`).then(a=>a.json()).then(a=>D(a))}}),$&&s&&(0,b.jsx)(aH,{open:$,onClose:()=>_(!1),pipelineId:Number.parseInt(s)})]})}var aX=a.i(3130),aY=a.i(24669),aZ=a.i(83077),a$=a.i(62722);function a_({pipelineId:a}){let[d,e]=(0,c.useState)({active:0,won:0,lost:0,totalValue:0,conversionRate:0});(0,c.useEffect)(()=>{a&&f(a)},[a]);let f=async a=>{try{let b=await fetch(`/api/pipelines/${a}/stats`),c=await b.json();e(c)}catch(a){console.error("Failed to fetch deal statistics:",a),e({active:47,won:23,lost:8,totalValue:125e3,conversionRate:74.2})}},g=[{title:"Active Deals",value:d.active,icon:aT.Activity,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",description:"Currently in pipeline"},{title:"Won Deals",value:d.won,icon:aZ.Trophy,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",description:"Successfully closed"},{title:"Lost Deals",value:d.lost,icon:a$.XCircle,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",description:"Not converted"},{title:"Conversion Rate",value:`${d.conversionRate}%`,icon:aY.TrendingUp,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",description:"Win rate"}];return(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:g.map((a,c)=>{let d=a.icon;return(0,b.jsx)(aX.Card,{className:`relative overflow-hidden border-2 ${a.borderColor} transition-all duration-200 hover:shadow-lg`,style:{animationDelay:`${100*c}ms`},children:(0,b.jsxs)(aX.CardContent,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:a.title}),(0,b.jsx)("p",{className:"text-3xl font-bold tracking-tight text-foreground",children:a.value}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),(0,b.jsx)("div",{className:`flex h-12 w-12 items-center justify-center rounded-xl ${a.bgColor}`,children:(0,b.jsx)(d,{className:`h-6 w-6 ${a.color}`})})]}),(0,b.jsx)("div",{className:`absolute top-0 right-0 w-32 h-32 ${a.bgColor} opacity-10 rounded-full -mr-16 -mt-16`})]})},a.title)})})}let a0=(0,q.default)("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var a1=a.i(69240);function a2(){let[a,f]=(0,c.useState)(null),[h,i]=(0,c.useState)(null),[j,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)("1"),[q,r]=(0,c.useState)(null),s=(0,d.useRouter)(),t=(0,d.useSearchParams)();if((0,c.useEffect)(()=>{let a=(0,a1.createClient)();a.auth.getUser().then(({data:{user:b},error:c})=>{c||!b?s.push("/auth/login"):(f(b),a.from("profiles").select("role").eq("id",b.id).single().then(({data:a})=>{a&&i(a.role)}))})},[s]),(0,c.useEffect)(()=>{if("create_deal"===t.get("action")){let a=t.get("playerId"),b=t.get("playerName"),c=t.get("playerEmail"),d=t.get("playerPhone");a&&b&&(r({id:a,name:b,email:c||void 0,phone:d||void 0}),l(!0))}},[t]),!a)return null;let u="admin"===h||"manager"===h;return(0,b.jsxs)(e.AppLayout,{user:a,title:"Pipelines",children:[(0,b.jsxs)("div",{className:"flex flex-col h-full max-w-full overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex-shrink-0",children:[(0,b.jsx)("div",{className:"gradient-primary mb-6 flex h-[72px] items-center rounded-2xl px-6 shadow-[0_2px_6px_rgba(0,0,0,0.06)]",children:(0,b.jsxs)("div",{className:"flex w-full flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[(0,b.jsx)("p",{className:"text-base text-white",style:{fontFamily:"Inter, sans-serif",fontWeight:400},children:"Track deals through your recruitment stages."}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(g.Button,{onClick:()=>{r(null),l(!0)},className:"gap-2 bg-white text-primary shadow-md hover:bg-muted transition-all duration-200 hover:shadow-lg active:scale-95",children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"New Deal"]}),u&&(0,b.jsxs)(g.Button,{onClick:()=>n(!0),className:"gap-2 bg-white text-primary shadow-md hover:bg-muted transition-all duration-200 hover:shadow-lg active:scale-95",children:[(0,b.jsx)(a0,{className:"h-4 w-4"}),"Add Stage"]})]})]})}),(0,b.jsx)(a_,{pipelineId:o})]}),(0,b.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,b.jsx)(aW,{})})]}),(0,b.jsx)(aD,{open:j,onClose:()=>{l(!1),r(null),s.replace("/pipelines")},preSelectedPlayer:q,onDealCreated:a=>{let b=new CustomEvent("dealCreated",{detail:a});window.dispatchEvent(b)}}),u&&(0,b.jsx)(aH,{open:m,onClose:()=>n(!1)})]})}function a3(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}),children:(0,b.jsx)(a2,{})})}a.s(["default",()=>a3],74332)}];

//# sourceMappingURL=_db0f4d02._.js.map