(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,55838,(e,t,a)=>{"use strict";var s=e.r(71645),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},l=s.useState,n=s.useEffect,i=s.useLayoutEffect,d=s.useDebugValue;function o(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!r(e,a)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),s=l({inst:{value:a,getSnapshot:t}}),r=s[0].inst,c=s[1];return i(function(){r.value=a,r.getSnapshot=t,o(r)&&c({inst:r})},[e,a,t]),n(function(){return o(r)&&c({inst:r}),e(function(){o(r)&&c({inst:r})})},[e]),d(a),a};a.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:c},2239,(e,t,a)=>{"use strict";t.exports=e.r(55838)},50393,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(40495),l=e.i(62870),n=e.i(67881),i=e.i(23750),d=e.i(40160),o=e.i(3116),c=e.i(7233),m=e.i(55436);function u(e){return e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}let x={"Initial Lead":"border-l-blue-400","Zoom Scheduled":"border-l-amber-400","Zoom Completed":"border-l-purple-400","Application Sent":"border-l-emerald-400",Accepted:"border-l-gray-400"};function h({deal:e,stageName:s,onClick:r,onDragStart:l}){let[n,i]=(0,a.useState)(!1),[d,o]=(0,a.useState)(!1),c=x[s]||"border-l-gray-400";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",rel:"stylesheet"}),(0,t.jsxs)("div",{draggable:!0,onDragStart:t=>{t.dataTransfer.setData("dealId",e.id.toString()),l(),o(!0)},onDragEnd:()=>o(!1),onClick:r,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:`group cursor-pointer rounded-xl border bg-white p-4 shadow-sm transition-all duration-200 ${c} border-l-4 ${d?"scale-105 opacity-50 shadow-lg":n?"shadow-md border-[#0A47B1] bg-[#F8FAFF]":"border-[#E6E8F0]"}`,style:{borderRadius:"12px"},children:[(0,t.jsx)("div",{className:"mb-3 flex items-start justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-xs font-semibold text-white",children:u(e.player_name)}),(0,t.jsx)("div",{children:(0,t.jsx)("h4",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"15px",color:"#0A0A0A"},children:e.player_name})})]})}),(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsxs)("div",{className:"font-semibold",style:{fontFamily:"Inter, sans-serif",fontWeight:600,color:"#00A35C",fontSize:"14px"},children:["£",e.deal_value.toLocaleString()]})}),(0,t.jsx)("div",{className:"mb-2 inline-block rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700",children:e.programme}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between border-t border-gray-100 pt-3 text-xs text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"h-5 w-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] font-medium text-gray-600",children:u(e.recruiter)}),(0,t.jsx)("span",{children:e.recruiter})]}),(0,t.jsx)("div",{className:"text-gray-400",children:e.last_activity})]})]})]})}var p=e.i(20682),g=e.i(75254);let f=(0,g.default)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var v=e.i(23585),j=e.i(88511),b=e.i(27612),N=e.i(30374),y=e.i(10708),w=e.i(63415),S=e.i(78894);function C({stage:e,availableStages:s,open:r,onClose:i,onConfirm:d}){let[o,c]=(0,a.useState)(""),[m,u]=(0,a.useState)(!1);if(!e)return null;let x=e.deals.length>0,h=e.deals.length,p=async()=>{u(!0);try{x&&o?await d(e,Number.parseInt(o)):await d(e),i(),c("")}finally{u(!1)}},g=()=>{m||(i(),c(""))};return(0,t.jsx)(N.Dialog,{open:r,onOpenChange:g,children:(0,t.jsxs)(N.DialogContent,{className:"sm:max-w-[480px]",children:[(0,t.jsxs)(N.DialogHeader,{children:[(0,t.jsxs)(N.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(S.AlertTriangle,{className:"h-5 w-5 text-destructive"}),"Delete Stage"]}),(0,t.jsx)(N.DialogDescription,{children:x?`This stage contains ${h} deal${h>1?"s":""}. Please select where to move ${h>1?"them":"it"} before deleting.`:"Are you sure you want to delete this stage? This action cannot be undone."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"rounded-lg bg-muted/50 p-3 border border-border",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Stage to delete:"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.name})]}),x&&s.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(y.Label,{htmlFor:"target-stage",children:"Move deals to"}),(0,t.jsxs)(l.Select,{value:o,onValueChange:c,children:[(0,t.jsx)(l.SelectTrigger,{id:"target-stage",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select a stage"})}),(0,t.jsx)(l.SelectContent,{children:s.map(e=>(0,t.jsxs)(l.SelectItem,{value:e.id.toString(),children:[e.name," (",e.deals.length," deals)"]},e.id))})]}),!o&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"You must select a target stage to move the deals to."})]}),x&&0===s.length&&(0,t.jsx)("div",{className:"rounded-lg bg-destructive/10 border border-destructive/20 p-3",children:(0,t.jsx)("p",{className:"text-sm text-destructive",children:"Cannot delete this stage. There are no other stages to move the deals to. Please create another stage first."})})]}),(0,t.jsxs)(N.DialogFooter,{children:[(0,t.jsx)(n.Button,{variant:"outline",onClick:g,disabled:m,children:"Cancel"}),(0,t.jsx)(n.Button,{variant:"destructive",onClick:p,disabled:m||x&&(!o||0===s.length),children:m?"Deleting...":"Delete Stage"})]})]})})}let k={Scheduled:"#a855f7","Zoom Scheduled":"#a855f7","Reschedule Zoom":"#10b981","Follow Up":"#facc15","Collecting Documents":"#fb923c",Applied:"#f43f5e","Conditional Offer":"#f97316","Dormant Lead":"#1d4ed8","Initial Lead":"#14b8a6","In Contact":"#38bdf8","Zoom Completed":"#a855f7","Application Sent":"#10b981",Accepted:"#6b7280"};function _({pipelineData:e,onDealClick:s,onDealMove:r,onStageEdit:l,onAddDeal:d}){let[o,m]=(0,a.useState)(null),[u,x]=(0,a.useState)(null),[g,S]=(0,a.useState)(null),[_,D]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!1),{toast:P}=(0,p.useToast)(),[T,F]=(0,a.useState)(null),[A,L]=(0,a.useState)(!1),[$,O]=(0,a.useState)(null),[M,V]=(0,a.useState)(""),B=()=>{S(null)},R=async(t,a)=>{if(t.preventDefault(),S(null),o&&u!==a){let t=e.stages.find(e=>e.id===a);await r(o.id,a),P({title:"Stage updated",description:`Moved to ${t?.name||"new stage"}`})}m(null),x(null)},z=async(t,a)=>{try{t.deals.length>0&&a&&await fetch(`/api/pipelines/${e.id}/stages/${t.id}/move-deals`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toStageId:a})}),(await fetch(`/api/pipelines/${e.id}/stages/${t.id}`,{method:"DELETE"})).ok&&(P({title:"Stage deleted",description:`${t.name} has been removed from the pipeline.`}),window.dispatchEvent(new Event("stageDeleted")))}catch(e){console.error("Failed to delete stage:",e),P({title:"Error",description:"Failed to delete stage. Please try again.",variant:"destructive"})}},U=async e=>{e.preventDefault(),D(!1);let t=e.dataTransfer.getData("dealId");if(t&&o){try{(await fetch(`/api/deals/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"won",closedAt:new Date().toISOString()})})).ok&&(P({title:"Deal marked as Won",description:`${o.player_name}'s deal has been marked as won.`}),window.dispatchEvent(new Event("dealCreated")))}catch(e){console.error("Failed to mark deal as won:",e),P({title:"Error",description:"Failed to mark deal as won. Please try again.",variant:"destructive"})}m(null),x(null)}},H=async e=>{e.preventDefault(),I(!1);let t=e.dataTransfer.getData("dealId");if(t&&o){try{(await fetch(`/api/deals/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"lost",closedAt:new Date().toISOString()})})).ok&&(P({title:"Deal marked as Lost",description:`${o.player_name}'s deal has been marked as lost.`}),window.dispatchEvent(new Event("dealCreated")))}catch(e){console.error("Failed to mark deal as lost:",e),P({title:"Error",description:"Failed to mark deal as lost. Please try again.",variant:"destructive"})}m(null),x(null)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600&display=swap",rel:"stylesheet"}),(0,t.jsxs)("div",{className:"h-full overflow-x-auto overflow-y-hidden rounded-lg border border-border bg-card p-4 shadow-sm",children:[(0,t.jsxs)("div",{className:"mb-4 flex gap-4",children:[(0,t.jsx)("div",{className:`won-zone flex-1 rounded-lg border-2 border-dashed p-6 text-center transition-all ${_?"border-green-500 bg-green-50 scale-[1.02]":"border-green-300 bg-green-50/50 hover:bg-green-50"}`,onDragOver:e=>{e.preventDefault(),D(!0)},onDragLeave:()=>{D(!1)},onDrop:U,children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-green-700",children:_?"Drop to mark as Won":"Drag a deal here to mark as Won"}),(0,t.jsx)("div",{className:"text-xs text-green-600",children:"The deal will be closed and removed from the board"})]})}),(0,t.jsx)("div",{className:`lost-zone flex-1 rounded-lg border-2 border-dashed p-6 text-center transition-all ${E?"border-red-500 bg-red-50 scale-[1.02]":"border-red-300 bg-red-50/50 hover:bg-red-50"}`,onDragOver:e=>{e.preventDefault(),I(!0)},onDragLeave:()=>{I(!1)},onDrop:H,children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-red-700",children:E?"Drop to mark as Lost":"Drag a deal here to mark as Lost"}),(0,t.jsx)("div",{className:"text-xs text-red-600",children:"The deal will be closed and removed from the board"})]})})]}),(0,t.jsx)("div",{className:"inline-flex gap-4 pb-2 animate-fade-in-up",children:e.stages.map((e,a)=>{let r=k[e.name]||"#6b7280",l=g===e.id,n=e.deals.reduce((e,t)=>e+(t.deal_value||0),0);return(0,t.jsxs)("div",{className:`flex w-80 flex-shrink-0 flex-col rounded-lg bg-card ${l?"ring-2 ring-primary ring-opacity-50":""} transition-all duration-200`,style:{animationDelay:`${80*a}ms`,borderLeft:a>0?"1px solid #E6E8F0":"none"},onDragOver:t=>{var a;return a=e.id,void(t.preventDefault(),S(a))},onDragLeave:B,onDrop:t=>R(t,e.id),children:[(0,t.jsxs)("div",{className:"px-4 rounded-t-lg border-b border-white/20",style:{backgroundColor:r,paddingTop:"15px",paddingBottom:"12px"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-white text-sm",style:{fontFamily:"Oswald, sans-serif",fontWeight:500,letterSpacing:"0.7px",color:"#FFFFFF"},children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[d&&(0,t.jsxs)("button",{onClick:()=>d(e.id),className:"flex items-center gap-1 px-2 py-1 rounded text-xs text-white/90 hover:bg-white/20 transition-colors",title:"Add deal to this stage",children:[(0,t.jsx)(c.Plus,{className:"h-3 w-3"}),"Add deal"]}),(0,t.jsxs)(w.DropdownMenu,{children:[(0,t.jsx)(w.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"flex h-6 w-6 items-center justify-center rounded hover:bg-white/20 transition-colors",children:(0,t.jsx)(v.MoreVertical,{className:"h-4 w-4 text-white"})})}),(0,t.jsxs)(w.DropdownMenuContent,{align:"end",children:[(0,t.jsxs)(w.DropdownMenuItem,{onClick:()=>{F(e),V(k[e.name]||"#6b7280"),L(!0)},children:[(0,t.jsx)(j.Edit,{className:"mr-2 h-4 w-4"}),"Edit Stage"]}),(0,t.jsxs)(w.DropdownMenuItem,{onClick:()=>O(e),className:"text-destructive focus:text-destructive",children:[(0,t.jsx)(b.Trash2,{className:"mr-2 h-4 w-4"}),"Delete Stage"]})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-0.5 text-xs text-white/90",children:[(0,t.jsxs)("div",{children:[e.deals.length," deals"]}),(0,t.jsxs)("div",{className:"font-semibold",children:["£",n.toLocaleString()]})]})]}),(0,t.jsxs)("div",{className:"flex-1 space-y-3 p-4 pt-3 overflow-y-auto max-h-[600px]",children:[e.deals.map(a=>(0,t.jsx)(h,{deal:a,stageName:e.name,onClick:()=>s(a),onDragStart:()=>{var t;return t=e.id,void(m(a),x(t))}},a.id)),0===e.deals.length&&(0,t.jsxs)("div",{className:"flex h-32 flex-col items-center justify-center text-center",children:[(0,t.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted mb-2",children:(0,t.jsx)(f,{className:"h-6 w-6 text-muted-foreground"})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No deals in this stage yet"}),d&&(0,t.jsxs)("button",{onClick:()=>d(e.id),className:"text-sm text-primary hover:text-primary/80 hover:underline font-medium flex items-center gap-1",children:[(0,t.jsx)(c.Plus,{className:"h-3 w-3"}),"Add deal"]})]})]})]},e.id)})})]}),(0,t.jsx)(N.Dialog,{open:A,onOpenChange:L,children:(0,t.jsxs)(N.DialogContent,{className:"max-w-3xl max-h-[90vh] my-4 overflow-hidden p-0 flex flex-col",children:[(0,t.jsx)("div",{className:"px-8 pt-8 pb-5 border-b border-border",children:(0,t.jsxs)(N.DialogHeader,{children:[(0,t.jsx)(N.DialogTitle,{className:"text-[26px] font-semibold tracking-tight leading-tight",children:"Edit Stage"}),(0,t.jsx)("p",{className:"text-[15px] text-muted-foreground mt-2 leading-relaxed",children:"Customise your pipeline stage"})]})}),T&&(0,t.jsxs)("div",{className:"px-8 py-8 space-y-8 overflow-y-auto max-h-[calc(100vh-180px)]",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(y.Label,{htmlFor:"stage-name",className:"text-[15px] font-semibold text-foreground",children:"Stage Name"}),(0,t.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Give this stage a descriptive name"})]}),(0,t.jsx)(i.Input,{id:"stage-name",defaultValue:T.name,placeholder:"e.g. Initial Contact",className:"h-12 text-[15px] bg-background"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(y.Label,{className:"text-[15px] font-semibold text-foreground",children:"Stage Colour"}),(0,t.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Choose a colour to represent this stage"})]}),(0,t.jsxs)("div",{className:"space-y-4 bg-muted/30 rounded-lg p-5",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Preset Colours"}),(0,t.jsx)("div",{className:"grid grid-cols-8 gap-2.5",children:["#14b8a6","#38bdf8","#a855f7","#10b981","#fb923c","#f43f5e","#facc15","#6b7280"].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>V(e),className:`h-11 w-11 rounded-lg border-2 transition-all hover:scale-105 active:scale-95 ${M===e?"border-primary ring-4 ring-primary/20 shadow-lg":"border-border hover:border-border/60"}`,style:{backgroundColor:e},title:e},e))})]}),(0,t.jsxs)("div",{className:"space-y-3 pt-3 border-t border-border/50",children:[(0,t.jsx)("p",{className:"text-[11px] font-semibold text-muted-foreground uppercase tracking-wider",children:"Custom Colour"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("input",{type:"color",value:M,onChange:e=>V(e.target.value),className:"h-12 w-20 cursor-pointer rounded-lg border-2 border-border",title:"Pick a custom colour"})}),(0,t.jsx)(i.Input,{value:M,onChange:e=>V(e.target.value),placeholder:"#000000",className:"h-12 flex-1 font-mono text-[13px] bg-background"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsx)(y.Label,{htmlFor:"stage-order",className:"text-[15px] font-semibold text-foreground",children:"Display Order"}),(0,t.jsx)("p",{className:"text-[13px] text-muted-foreground leading-relaxed",children:"Position of this stage in the pipeline (left to right)"})]}),(0,t.jsx)(i.Input,{id:"stage-order",type:"number",min:"1",defaultValue:T.order,placeholder:"1",className:"h-12 text-[15px] bg-background"})]})]}),(0,t.jsx)("div",{className:"px-8 py-6 border-t border-border bg-muted/20",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.Button,{size:"lg",className:"flex-1 h-12 text-[15px] font-medium shadow-sm gradient-primary",onClick:()=>{if(T){let e=document.getElementById("stage-name"),t=document.getElementById("stage-order");l(T.id,e.value,M,Number.parseInt(t.value)),L(!1)}},children:"Save Changes"}),(0,t.jsx)(n.Button,{size:"lg",variant:"outline",className:"flex-1 h-12 text-[15px] font-medium bg-background",onClick:()=>L(!1),children:"Cancel"})]})})]})}),(0,t.jsx)(C,{stage:$,availableStages:e.stages.filter(e=>e.id!==$?.id),open:!!$,onClose:()=>O(null),onConfirm:z})]})}function D({open:e,onClose:s,onSuccess:r}){let[l,d]=(0,a.useState)(""),[o,c]=(0,a.useState)(!1),{toast:m}=(0,p.useToast)(),u=async e=>{e.preventDefault(),c(!0);try{(await fetch("/api/pipelines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l})})).ok?(m({title:"Pipeline created successfully"}),d(""),s(),r&&r()):m({title:"Failed to create pipeline",variant:"destructive"})}catch(e){m({title:"An error occurred",variant:"destructive"})}finally{c(!1)}};return(0,t.jsx)(N.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(N.DialogContent,{className:"sm:max-w-[440px]",children:[(0,t.jsxs)(N.DialogHeader,{children:[(0,t.jsx)(N.DialogTitle,{children:"Add pipeline"}),(0,t.jsx)(N.DialogDescription,{children:"Create a new pipeline for managing deals"})]}),(0,t.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(y.Label,{htmlFor:"pipeline-name",children:"Pipeline name *"}),(0,t.jsx)(i.Input,{id:"pipeline-name",value:l,onChange:e=>d(e.target.value),placeholder:"e.g. US College Recruitment",required:!0})]}),(0,t.jsxs)(N.DialogFooter,{children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:s,disabled:o,children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",className:"gradient-primary",disabled:o,children:o?"Creating...":"Create pipeline"})]})]})]})})}var E=e.i(84762),I=e.i(31278),P=e.i(84614),T=e.i(32095);let F=(0,g.default)("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);var A=e.i(26090),L=e.i(12426),$=e.i(78583),O=/[\\\/_+.#"@\[\(\{&]/,M=/[\\\/_+.#"@\[\(\{&]/g,V=/[\s-]/,B=/[\s-]/g;function R(e){return e.toLowerCase().replace(B," ")}var z=e.i(26999),U=e.i(48425),H=e.i(10772),q=e.i(2239),J='[cmdk-group=""]',W='[cmdk-group-items=""]',K='[cmdk-item=""]',G=`${K}:not([aria-disabled="true"])`,Z="cmdk-item-select",Y="data-value",X=(e,t,a)=>{var s;return s=e,function e(t,a,s,r,l,n,i){if(n===a.length)return l===t.length?1:.99;var d=`${l},${n}`;if(void 0!==i[d])return i[d];for(var o,c,m,u,x=r.charAt(n),h=s.indexOf(x,l),p=0;h>=0;)(o=e(t,a,s,r,h+1,n+1,i))>p&&(h===l?o*=1:O.test(t.charAt(h-1))?(o*=.8,(m=t.slice(l,h-1).match(M))&&l>0&&(o*=Math.pow(.999,m.length))):V.test(t.charAt(h-1))?(o*=.9,(u=t.slice(l,h-1).match(B))&&l>0&&(o*=Math.pow(.999,u.length))):(o*=.17,l>0&&(o*=Math.pow(.999,h-l))),t.charAt(h)!==a.charAt(n)&&(o*=.9999)),(o<.1&&s.charAt(h-1)===r.charAt(n+1)||r.charAt(n+1)===r.charAt(n)&&s.charAt(h-1)!==r.charAt(n))&&.1*(c=e(t,a,s,r,h+1,n+2,i))>o&&(o=.1*c),o>p&&(p=o),h=s.indexOf(x,h+1);return i[d]=p,p}(s=a&&a.length>0?`${s+" "+a.join(" ")}`:s,t,R(s),R(t),0,0,{})},Q=a.createContext(void 0),ee=a.createContext(void 0),et=a.createContext(void 0),ea=a.forwardRef((e,t)=>{let s=eu(()=>{var t,a;return{search:"",value:null!=(a=null!=(t=e.value)?t:e.defaultValue)?a:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=eu(()=>new Set),l=eu(()=>new Map),n=eu(()=>new Map),i=eu(()=>new Set),d=ec(e),{label:o,children:c,value:m,onValueChange:u,filter:x,shouldFilter:h,loop:p,disablePointerSelection:g=!1,vimBindings:f=!0,...v}=e,j=(0,H.useId)(),b=(0,H.useId)(),N=(0,H.useId)(),y=a.useRef(null),w=eg();em(()=>{if(void 0!==m){let e=m.trim();s.current.value=e,S.emit()}},[m]),em(()=>{w(6,I)},[]);let S=a.useMemo(()=>({subscribe:e=>(i.current.add(e),()=>i.current.delete(e)),snapshot:()=>s.current,setState:(e,t,a)=>{var r,l,n;if(!Object.is(s.current[e],t)){if(s.current[e]=t,"search"===e)E(),_(),w(1,D);else if("value"===e&&(a||w(5,I),(null==(r=d.current)?void 0:r.value)!==void 0)){null==(n=(l=d.current).onValueChange)||n.call(l,null!=t?t:"");return}S.emit()}},emit:()=>{i.current.forEach(e=>e())}}),[]),C=a.useMemo(()=>({value:(e,t,a)=>{var r;t!==(null==(r=n.current.get(e))?void 0:r.value)&&(n.current.set(e,{value:t,keywords:a}),s.current.filtered.items.set(e,k(t,a)),w(2,()=>{_(),S.emit()}))},item:(e,t)=>(r.current.add(e),t&&(l.current.has(t)?l.current.get(t).add(e):l.current.set(t,new Set([e]))),w(3,()=>{E(),_(),s.current.value||D(),S.emit()}),()=>{n.current.delete(e),r.current.delete(e),s.current.filtered.items.delete(e);let t=P();w(4,()=>{E(),(null==t?void 0:t.getAttribute("id"))===e&&D(),S.emit()})}),group:e=>(l.current.has(e)||l.current.set(e,new Set),()=>{n.current.delete(e),l.current.delete(e)}),filter:()=>d.current.shouldFilter,label:o||e["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:j,inputId:N,labelId:b,listInnerRef:y}),[]);function k(e,t){var a,r;let l=null!=(r=null==(a=d.current)?void 0:a.filter)?r:X;return e?l(e,s.current.search,t):0}function _(){if(!s.current.search||!1===d.current.shouldFilter)return;let e=s.current.filtered.items,t=[];s.current.filtered.groups.forEach(a=>{let s=l.current.get(a),r=0;s.forEach(t=>{r=Math.max(e.get(t),r)}),t.push([a,r])});let a=y.current;T().sort((t,a)=>{var s,r;let l=t.getAttribute("id"),n=a.getAttribute("id");return(null!=(s=e.get(n))?s:0)-(null!=(r=e.get(l))?r:0)}).forEach(e=>{let t=e.closest(W);t?t.appendChild(e.parentElement===t?e:e.closest(`${W} > *`)):a.appendChild(e.parentElement===a?e:e.closest(`${W} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let a=null==(t=y.current)?void 0:t.querySelector(`${J}[${Y}="${encodeURIComponent(e[0])}"]`);null==a||a.parentElement.appendChild(a)})}function D(){let e=T().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(Y);S.setState("value",t||void 0)}function E(){var e,t,a,i;if(!s.current.search||!1===d.current.shouldFilter){s.current.filtered.count=r.current.size;return}s.current.filtered.groups=new Set;let o=0;for(let l of r.current){let r=k(null!=(t=null==(e=n.current.get(l))?void 0:e.value)?t:"",null!=(i=null==(a=n.current.get(l))?void 0:a.keywords)?i:[]);s.current.filtered.items.set(l,r),r>0&&o++}for(let[e,t]of l.current)for(let a of t)if(s.current.filtered.items.get(a)>0){s.current.filtered.groups.add(e);break}s.current.filtered.count=o}function I(){var e,t,a;let s=P();s&&((null==(e=s.parentElement)?void 0:e.firstChild)===s&&(null==(a=null==(t=s.closest(J))?void 0:t.querySelector('[cmdk-group-heading=""]'))||a.scrollIntoView({block:"nearest"})),s.scrollIntoView({block:"nearest"}))}function P(){var e;return null==(e=y.current)?void 0:e.querySelector(`${K}[aria-selected="true"]`)}function T(){var e;return Array.from((null==(e=y.current)?void 0:e.querySelectorAll(G))||[])}function F(e){let t=T()[e];t&&S.setState("value",t.getAttribute(Y))}function A(e){var t;let a=P(),s=T(),r=s.findIndex(e=>e===a),l=s[r+e];null!=(t=d.current)&&t.loop&&(l=r+e<0?s[s.length-1]:r+e===s.length?s[0]:s[r+e]),l&&S.setState("value",l.getAttribute(Y))}function L(e){let t=P(),a=null==t?void 0:t.closest(J),s;for(;a&&!s;)s=null==(a=e>0?function(e,t){let a=e.nextElementSibling;for(;a;){if(a.matches(t))return a;a=a.nextElementSibling}}(a,J):function(e,t){let a=e.previousElementSibling;for(;a;){if(a.matches(t))return a;a=a.previousElementSibling}}(a,J))?void 0:a.querySelector(G);s?S.setState("value",s.getAttribute(Y)):A(e)}let $=()=>F(T().length-1),O=e=>{e.preventDefault(),e.metaKey?$():e.altKey?L(1):A(1)},M=e=>{e.preventDefault(),e.metaKey?F(0):e.altKey?L(-1):A(-1)};return a.createElement(U.Primitive.div,{ref:t,tabIndex:-1,...v,"cmdk-root":"",onKeyDown:e=>{var t;if(null==(t=v.onKeyDown)||t.call(v,e),!e.defaultPrevented)switch(e.key){case"n":case"j":f&&e.ctrlKey&&O(e);break;case"ArrowDown":O(e);break;case"p":case"k":f&&e.ctrlKey&&M(e);break;case"ArrowUp":M(e);break;case"Home":e.preventDefault(),F(0);break;case"End":e.preventDefault(),$();break;case"Enter":if(!e.nativeEvent.isComposing&&229!==e.keyCode){e.preventDefault();let t=P();if(t){let e=new Event(Z);t.dispatchEvent(e)}}}}},a.createElement("label",{"cmdk-label":"",htmlFor:C.inputId,id:C.labelId,style:ev},o),ef(e,e=>a.createElement(ee.Provider,{value:S},a.createElement(Q.Provider,{value:C},e))))}),es=a.forwardRef((e,t)=>{var s,r;let l=(0,H.useId)(),n=a.useRef(null),i=a.useContext(et),d=a.useContext(Q),o=ec(e),c=null!=(r=null==(s=o.current)?void 0:s.forceMount)?r:null==i?void 0:i.forceMount;em(()=>{if(!c)return d.item(l,null==i?void 0:i.id)},[c]);let m=ep(l,n,[e.value,e.children,n],e.keywords),u=a.useContext(ee),x=eh(e=>e.value&&e.value===m.current),h=eh(e=>!!c||!1===d.filter()||!e.search||e.filtered.items.get(l)>0);function p(){var e,t;g(),null==(t=(e=o.current).onSelect)||t.call(e,m.current)}function g(){u.setState("value",m.current,!0)}if(a.useEffect(()=>{let t=n.current;if(!(!t||e.disabled))return t.addEventListener(Z,p),()=>t.removeEventListener(Z,p)},[h,e.onSelect,e.disabled]),!h)return null;let{disabled:f,value:v,onSelect:j,forceMount:b,keywords:N,...y}=e;return a.createElement(U.Primitive.div,{ref:ex([n,t]),...y,id:l,"cmdk-item":"",role:"option","aria-disabled":!!f,"aria-selected":!!x,"data-disabled":!!f,"data-selected":!!x,onPointerMove:f||d.getDisablePointerSelection()?void 0:g,onClick:f?void 0:p},e.children)}),er=a.forwardRef((e,t)=>{let{heading:s,children:r,forceMount:l,...n}=e,i=(0,H.useId)(),d=a.useRef(null),o=a.useRef(null),c=(0,H.useId)(),m=a.useContext(Q),u=eh(e=>!!l||!1===m.filter()||!e.search||e.filtered.groups.has(i));em(()=>m.group(i),[]),ep(i,d,[e.value,e.heading,o]);let x=a.useMemo(()=>({id:i,forceMount:l}),[l]);return a.createElement(U.Primitive.div,{ref:ex([d,t]),...n,"cmdk-group":"",role:"presentation",hidden:!u||void 0},s&&a.createElement("div",{ref:o,"cmdk-group-heading":"","aria-hidden":!0,id:c},s),ef(e,e=>a.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":s?c:void 0},a.createElement(et.Provider,{value:x},e))))}),el=a.forwardRef((e,t)=>{let{alwaysRender:s,...r}=e,l=a.useRef(null),n=eh(e=>!e.search);return s||n?a.createElement(U.Primitive.div,{ref:ex([l,t]),...r,"cmdk-separator":"",role:"separator"}):null}),en=a.forwardRef((e,t)=>{let{onValueChange:s,...r}=e,l=null!=e.value,n=a.useContext(ee),i=eh(e=>e.search),d=eh(e=>e.value),o=a.useContext(Q),c=a.useMemo(()=>{var e;let t=null==(e=o.listInnerRef.current)?void 0:e.querySelector(`${K}[${Y}="${encodeURIComponent(d)}"]`);return null==t?void 0:t.getAttribute("id")},[]);return a.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),a.createElement(U.Primitive.input,{ref:t,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":o.listId,"aria-labelledby":o.labelId,"aria-activedescendant":c,id:o.inputId,type:"text",value:l?e.value:i,onChange:e=>{l||n.setState("search",e.target.value),null==s||s(e.target.value)}})}),ei=a.forwardRef((e,t)=>{let{children:s,label:r="Suggestions",...l}=e,n=a.useRef(null),i=a.useRef(null),d=a.useContext(Q);return a.useEffect(()=>{if(i.current&&n.current){let e=i.current,t=n.current,a,s=new ResizeObserver(()=>{a=requestAnimationFrame(()=>{let a=e.offsetHeight;t.style.setProperty("--cmdk-list-height",a.toFixed(1)+"px")})});return s.observe(e),()=>{cancelAnimationFrame(a),s.unobserve(e)}}},[]),a.createElement(U.Primitive.div,{ref:ex([n,t]),...l,"cmdk-list":"",role:"listbox","aria-label":r,id:d.listId},ef(e,e=>a.createElement("div",{ref:ex([i,d.listInnerRef]),"cmdk-list-sizer":""},e)))}),ed=a.forwardRef((e,t)=>{let{open:s,onOpenChange:r,overlayClassName:l,contentClassName:n,container:i,...d}=e;return a.createElement(z.Root,{open:s,onOpenChange:r},a.createElement(z.Portal,{container:i},a.createElement(z.Overlay,{"cmdk-overlay":"",className:l}),a.createElement(z.Content,{"aria-label":e.label,"cmdk-dialog":"",className:n},a.createElement(ea,{ref:t,...d}))))}),eo=Object.assign(ea,{List:ei,Item:es,Input:en,Group:er,Separator:el,Dialog:ed,Empty:a.forwardRef((e,t)=>eh(e=>0===e.filtered.count)?a.createElement(U.Primitive.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Loading:a.forwardRef((e,t)=>{let{progress:s,children:r,label:l="Loading...",...n}=e;return a.createElement(U.Primitive.div,{ref:t,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},ef(e,e=>a.createElement("div",{"aria-hidden":!0},e)))})});function ec(e){let t=a.useRef(e);return em(()=>{t.current=e}),t}var em="undefined"==typeof window?a.useEffect:a.useLayoutEffect;function eu(e){let t=a.useRef();return void 0===t.current&&(t.current=e()),t}function ex(e){return t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}}function eh(e){let t=a.useContext(ee),s=()=>e(t.snapshot());return(0,q.useSyncExternalStore)(t.subscribe,s,s)}function ep(e,t,s,r=[]){let l=a.useRef(),n=a.useContext(Q);return em(()=>{var a;let i=(()=>{var e;for(let t of s){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():l.current}})(),d=r.map(e=>e.trim());n.value(e,i,d),null==(a=t.current)||a.setAttribute(Y,i),l.current=i}),l}var eg=()=>{let[e,t]=a.useState(),s=eu(()=>new Map);return em(()=>{s.current.forEach(e=>e()),s.current=new Map},[e]),(e,a)=>{s.current.set(e,a),t({})}};function ef({asChild:e,children:t},s){let r;return e&&a.isValidElement(t)?a.cloneElement("function"==typeof(r=t.type)?r(t.props):"render"in r?r.render(t.props):t,{ref:t.ref},s(t.props.children)):s(t)}var ev={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"},ej=e.i(54943),ej=ej,eb=e.i(47163);function eN({className:e,...a}){return(0,t.jsx)(eo,{"data-slot":"command",className:(0,eb.cn)("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",e),...a})}function ey({className:e,...a}){return(0,t.jsxs)("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[(0,t.jsx)(ej.default,{className:"size-4 shrink-0 opacity-50"}),(0,t.jsx)(eo.Input,{"data-slot":"command-input",className:(0,eb.cn)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",e),...a})]})}function ew({className:e,...a}){return(0,t.jsx)(eo.List,{"data-slot":"command-list",className:(0,eb.cn)("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",e),...a})}function eS({...e}){return(0,t.jsx)(eo.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...e})}function eC({className:e,...a}){return(0,t.jsx)(eo.Group,{"data-slot":"command-group",className:(0,eb.cn)("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",e),...a})}function ek({className:e,...a}){return(0,t.jsx)(eo.Item,{"data-slot":"command-item",className:(0,eb.cn)("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...a})}var e_=e.i(59377),eD=e.i(43531);function eE({open:e,onClose:s,preSelectedStageId:r,preSelectedPlayer:d,onDealCreated:o}){let[c,m]=(0,a.useState)(!1),[u,x]=(0,a.useState)([]),[h,g]=(0,a.useState)([]),[f,v]=(0,a.useState)([]),[j,b]=(0,a.useState)([]),[w,S]=(0,a.useState)(!1),[C,k]=(0,a.useState)({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),[_,D]=(0,a.useState)({player_name:"",programme_id:""}),{toast:O}=(0,p.useToast)();(0,a.useEffect)(()=>{e&&(M(),V(),R())},[e]),(0,a.useEffect)(()=>{C.programme_id&&B(C.programme_id)},[C.programme_id]),(0,a.useEffect)(()=>{r&&f.length>0&&f.find(e=>e.id===r)&&k(e=>({...e,stage_id:r.toString()}))},[r,f]),(0,a.useEffect)(()=>{d&&k(e=>({...e,player_id:d.id,player_name:d.name}))},[d]);let M=async()=>{x([{id:1,name:"John Smith",email:"john.smith@example.com"},{id:2,name:"Emma Johnson",email:"emma.j@example.com"},{id:3,name:"Michael Chen",email:"m.chen@example.com"}])},V=async()=>{g([{id:1,name:"Youth Academy"},{id:2,name:"Elite Training"},{id:3,name:"Summer Camp"}])},B=async e=>{v([{id:1,name:"New Lead"},{id:2,name:"Contacted"},{id:3,name:"Trial Scheduled"},{id:4,name:"Offer Sent"},{id:5,name:"Signed"}]),C.stage_id||k(e=>({...e,stage_id:"1"}))},R=async()=>{b([{id:1,name:"Sarah Wilson"},{id:2,name:"Mike Thompson"},{id:3,name:"David Brown"}])},z=async e=>{let t;e.preventDefault(),t={player_name:"",programme_id:""},C.player_name||(t.player_name="Player name is required"),C.programme_id||(t.programme_id="Programme is required"),D(t),t.player_name||t.programme_id||(m(!0),setTimeout(()=>{let e=j.find(e=>e.id.toString()===C.recruiter_id),t=h.find(e=>e.id.toString()===C.programme_id),a=f.find(e=>e.id.toString()===C.stage_id),r={id:Math.floor(1e3*Math.random()),player_name:C.player_name,email:d?.email||"player@example.com",phone:d?.phone||"+44 7700 900000",programme:t?.name||"Youth Academy",recruiter:e?.name||"Sarah Wilson",status:"active",last_activity:new Date().toISOString(),stage_id:parseInt(C.stage_id),stage_name:a?.name||"New Lead",recruiter_id:C.recruiter_id?parseInt(C.recruiter_id):1,program_id:parseInt(C.programme_id),deal_value:C.deal_value?parseFloat(C.deal_value):0,notes:C.notes,pipeline_id:C.programme_id};O({title:"Deal created",description:`${C.player_name} has been added to the pipeline.`}),k({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),o&&o(r),s(),m(!1)},1e3))};return(0,t.jsx)(N.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(N.DialogContent,{className:"sm:max-w-[500px] bg-white shadow-xl",children:[(0,t.jsxs)(N.DialogHeader,{className:"border-b pb-4",children:[(0,t.jsx)(N.DialogTitle,{className:"text-xl font-semibold text-gray-900",children:"Create New Deal"}),(0,t.jsx)(N.DialogDescription,{className:"text-sm text-gray-500",children:"Add a new player to your recruitment pipeline"})]}),(0,t.jsxs)("form",{onSubmit:z,className:"space-y-5 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"player_name",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(P.User,{className:"h-4 w-4 text-blue-600"}),"Player Name ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(e_.Popover,{open:w,onOpenChange:S,children:[(0,t.jsx)(e_.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",role:"combobox","aria-expanded":w,className:(0,eb.cn)("w-full justify-between",!C.player_name&&"text-muted-foreground",_.player_name&&"border-red-500 focus:ring-red-500"),children:[C.player_name||"Select or type player name...",(0,t.jsx)(eD.Check,{className:(0,eb.cn)("ml-2 h-4 w-4",C.player_name?"opacity-100":"opacity-0")})]})}),(0,t.jsx)(e_.PopoverContent,{className:"w-[460px] p-0",children:(0,t.jsxs)(eN,{children:[(0,t.jsx)(ey,{placeholder:"Search players...",value:C.player_name,onValueChange:e=>{k(t=>({...t,player_name:e,player_id:""})),D(e=>({...e,player_name:""}))}}),(0,t.jsxs)(ew,{children:[(0,t.jsx)(eS,{children:"No player found. Keep typing to add new player."}),(0,t.jsx)(eC,{children:u.map(e=>(0,t.jsxs)(ek,{value:e.name,onSelect:()=>{k(t=>({...t,player_id:e.id.toString(),player_name:e.name})),D(e=>({...e,player_name:""})),S(!1)},children:[(0,t.jsx)(eD.Check,{className:(0,eb.cn)("mr-2 h-4 w-4",C.player_id===e.id.toString()?"opacity-100":"opacity-0")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.email})]})]},e.id))})]})]})})]}),_.player_name&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:_.player_name})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"programme",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(T.GraduationCap,{className:"h-4 w-4 text-purple-600"}),"Programme ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(l.Select,{value:C.programme_id,onValueChange:e=>{k(t=>({...t,programme_id:e,stage_id:""})),D(e=>({...e,programme_id:""}))},children:[(0,t.jsx)(l.SelectTrigger,{className:(0,eb.cn)("w-full",_.programme_id&&"border-red-500 focus:ring-red-500"),children:(0,t.jsx)(l.SelectValue,{placeholder:"Select programme"})}),(0,t.jsx)(l.SelectContent,{children:h.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),_.programme_id&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:_.programme_id})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"stage",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(F,{className:"h-4 w-4 text-green-600"}),"Stage"]}),(0,t.jsxs)(l.Select,{value:C.stage_id,onValueChange:e=>k(t=>({...t,stage_id:e})),disabled:!C.programme_id,children:[(0,t.jsx)(l.SelectTrigger,{className:"w-full",children:(0,t.jsx)(l.SelectValue,{placeholder:C.programme_id?"Select stage":"Select programme first"})}),(0,t.jsx)(l.SelectContent,{children:f.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"recruiter",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(A.UserCircle2,{className:"h-4 w-4 text-blue-600"}),"Assigned Recruiter"]}),(0,t.jsxs)(l.Select,{value:C.recruiter_id,onValueChange:e=>k(t=>({...t,recruiter_id:e})),children:[(0,t.jsx)(l.SelectTrigger,{className:"w-full",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select recruiter"})}),(0,t.jsx)(l.SelectContent,{children:j.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"deal_value",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(L.DollarSign,{className:"h-4 w-4 text-green-600"}),"Deal Value (£)"]}),(0,t.jsx)(i.Input,{id:"deal_value",type:"number",placeholder:"0.00",value:C.deal_value,onChange:e=>k(t=>({...t,deal_value:e.target.value})),className:"focus:border-blue-500 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"notes",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)($.FileText,{className:"h-4 w-4 text-gray-600"}),"Notes"]}),(0,t.jsx)(E.Textarea,{id:"notes",placeholder:"Add any additional notes...",value:C.notes,onChange:e=>k(t=>({...t,notes:e.target.value})),className:"resize-none focus:border-blue-500 focus:ring-blue-500",rows:3})]}),(0,t.jsxs)(N.DialogFooter,{className:"gap-2 pt-4 border-t",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:()=>{k({player_id:"",player_name:"",programme_id:"",stage_id:"",recruiter_id:"",deal_value:"",notes:""}),D({player_name:"",programme_id:""}),s()},disabled:c,className:"hover:bg-gray-100 bg-transparent",children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:c,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg",children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Deal"})]})]})]})})}let eI=(0,g.default)("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),eP=(0,g.default)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),eT=[{name:"Teal",value:"bg-teal-500",hex:"#14b8a6"},{name:"Sky Blue",value:"bg-sky-500",hex:"#0ea5e9"},{name:"Purple",value:"bg-purple-500",hex:"#a855f7"},{name:"Green",value:"bg-green-500",hex:"#22c55e"},{name:"Orange",value:"bg-orange-500",hex:"#f97316"},{name:"Pink",value:"bg-pink-500",hex:"#ec4899"},{name:"Indigo",value:"bg-indigo-500",hex:"#6366f1"},{name:"Yellow",value:"bg-yellow-500",hex:"#eab308"}];function eF({open:e,onClose:s}){let[r,d]=(0,a.useState)(!1),[o,c]=(0,a.useState)([]),[m,u]=(0,a.useState)([]),[x,h]=(0,a.useState)(""),[g,f]=(0,a.useState)({name:"",color:"",order:""}),[v,j]=(0,a.useState)({name:"",pipeline:""}),{toast:b}=(0,p.useToast)();(0,a.useEffect)(()=>{e&&w()},[e]),(0,a.useEffect)(()=>{x&&S(x)},[x]);let w=async()=>{try{let e=await fetch("/api/pipelines"),t=await e.json();c(t),t.length>0&&h(t[0].id.toString())}catch(e){console.error("Failed to fetch pipelines:",e)}},S=async e=>{try{let t=await fetch(`/api/pipelines/${e}/stages?stagesOnly=true`),a=await t.json();if(u(a||[]),!g.color&&a&&a.length>0){let e=a.length%eT.length;f(t=>({...t,color:eT[e].hex}))}a&&a.length>0&&!g.order?f(e=>({...e,order:(a.length+1).toString()})):g.order||f(e=>({...e,order:"1"}))}catch(e){console.error("Failed to fetch stages:",e)}},C=async e=>{let t;if(e.preventDefault(),t={name:"",pipeline:""},g.name.trim()||(t.name="Stage name is required"),x||(t.pipeline="Pipeline is required"),j(t),!t.name&&!t.pipeline){d(!0);try{let e=await fetch("/api/stages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pipeline_id:x,name:g.name.trim(),color:g.color||eT[0].hex,order:g.order?Number.parseInt(g.order):m.length+1})});if(e.ok)b({title:"Stage added successfully",description:`${g.name} has been added to the pipeline.`}),f({name:"",color:"",order:""}),window.dispatchEvent(new CustomEvent("stageCreated")),s();else{let t=await e.json();b({title:"Failed to add stage",description:t.error||"Please try again.",variant:"destructive"})}}catch(e){console.error("Error adding stage:",e),b({title:"Failed to add stage",description:"An unexpected error occurred.",variant:"destructive"})}finally{d(!1)}}};return(0,t.jsx)(N.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(N.DialogContent,{className:"sm:max-w-[500px] bg-white shadow-xl",children:[(0,t.jsxs)(N.DialogHeader,{className:"border-b pb-4",children:[(0,t.jsx)(N.DialogTitle,{className:"text-xl font-semibold text-gray-900",children:"Add New Stage"}),(0,t.jsx)(N.DialogDescription,{className:"text-sm text-gray-500",children:"Add a new stage to your recruitment pipeline"})]}),(0,t.jsxs)("form",{onSubmit:C,className:"space-y-5 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"pipeline",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(F,{className:"h-4 w-4 text-blue-600"}),"Pipeline ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)(l.Select,{value:x,onValueChange:h,children:[(0,t.jsx)(l.SelectTrigger,{className:"w-full",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select pipeline"})}),(0,t.jsx)(l.SelectContent,{children:o.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),v.pipeline&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:v.pipeline})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"name",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(F,{className:"h-4 w-4 text-purple-600"}),"Stage Name ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(i.Input,{id:"name",placeholder:"e.g., Initial Contact, Interview Scheduled",value:g.name,onChange:e=>{f(t=>({...t,name:e.target.value})),j(e=>({...e,name:""}))},className:v.name?"border-red-500 focus:ring-red-500":"focus:border-blue-500 focus:ring-blue-500"}),v.name&&(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1",children:v.name})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"color",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(eI,{className:"h-4 w-4 text-pink-600"}),"Color (optional)"]}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:eT.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>f(t=>({...t,color:e.hex})),className:`flex items-center gap-2 p-2 rounded-lg border-2 transition-all ${g.color===e.hex?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsx)("div",{className:`w-6 h-6 rounded ${e.value}`}),(0,t.jsx)("span",{className:"text-xs font-medium",children:e.name})]},e.hex))}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:g.color?"Selected color will be used for this stage":"A color will be auto-assigned"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(y.Label,{htmlFor:"order",className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[(0,t.jsx)(eP,{className:"h-4 w-4 text-green-600"}),"Order Position (optional)"]}),(0,t.jsx)(i.Input,{id:"order",type:"number",min:"1",max:m.length+1,placeholder:`Position (1-${m.length+1})`,value:g.order,onChange:e=>f(t=>({...t,order:e.target.value})),className:"focus:border-blue-500 focus:ring-blue-500"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Leave empty to add at the end. Current stages: ",m.length]})]}),(0,t.jsxs)(N.DialogFooter,{className:"gap-2 pt-4 border-t",children:[(0,t.jsx)(n.Button,{type:"button",variant:"outline",onClick:()=>{f({name:"",color:"",order:""}),j({name:"",pipeline:""}),s()},disabled:r,className:"hover:bg-gray-100 bg-transparent",children:"Cancel"}),(0,t.jsx)(n.Button,{type:"submit",disabled:r,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg",children:r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(I.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Stage"})]})]})]})})}var eA=e.i(27341),eL=e.i(94179),e$=e.i(63488),eO=e.i(43432),eM=e.i(78917),eV=e.i(14764),eB=e.i(87316),eR=e.i(37727),ez=e.i(61659),eU=e.i(95468),eH=e.i(63209),eq=e.i(21218),eJ=e.i(22016);function eW({deal:e,open:s,onClose:r,stages:c,pipelineId:m,onDealUpdated:u}){let[x,h]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[v,b]=(0,a.useState)(""),[w,S]=(0,a.useState)(""),[C,k]=(0,a.useState)(null),[_,D]=(0,a.useState)(""),[I,P]=(0,a.useState)([]),[F,O]=(0,a.useState)(!1),[M,V]=(0,a.useState)(!1),{toast:B}=(0,p.useToast)();(0,a.useEffect)(()=>{e&&s&&(f(e.recruiter_id||null),b(e.deal_value?.toString()||""),S(e.notes||""),k(e.stage_id||null),D(e.next_follow_up||""),R())},[e,s]);let R=async()=>{let e=await fetch("/api/settings/recruiters"),t=await e.json();P(Array.isArray(t)?t:t.data||[])},z=async t=>{if(!e||F)return;O(!0);let a=Number.parseInt(t);try{if((await fetch(`/api/deals/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage_id:a})})).ok){k(a);let t=c.find(e=>e.id===a)?.name||"";B({title:"Stage updated",description:`Deal moved to ${t}`}),u&&u({...e,stage_id:a,stage_name:t})}else B({title:"Error",description:"Failed to update stage",variant:"destructive"}),k(e.stage_id||null)}catch(t){B({title:"Error",description:"Failed to update stage",variant:"destructive"}),k(e.stage_id||null)}finally{O(!1)}},U=async t=>{if(e&&!M){D(t),V(!0);try{(await fetch(`/api/deals/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({next_follow_up:t})})).ok||(B({title:"Error",description:"Failed to save follow-up date",variant:"destructive"}),D(e.next_follow_up||""))}catch(t){B({title:"Error",description:"Failed to save follow-up date",variant:"destructive"}),D(e.next_follow_up||"")}finally{V(!1)}}},H=async()=>{if(e)try{if((await fetch(`/api/deals/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({recruiter_id:g,deal_value:v?Number.parseFloat(v):void 0,notes:w})})).ok){let t=I.find(e=>e.id===g)?.full_name||I.find(e=>e.id===g)?.name||e.recruiter;B({title:"Deal updated",description:"Changes saved successfully"}),h(!1),u&&u({...e,recruiter_id:g||e.recruiter_id,recruiter:t,deal_value:v?Number.parseFloat(v):e.deal_value,notes:w})}else B({title:"Error",description:"Failed to save changes",variant:"destructive"})}catch(e){B({title:"Error",description:"Failed to save changes",variant:"destructive"})}};if(!e)return null;let q=c.find(e=>e.id===C)?.name||e.stage_name||"Unknown Stage";return(0,t.jsx)(N.Dialog,{open:s,onOpenChange:r,children:(0,t.jsxs)(N.DialogContent,{className:"max-w-2xl max-h-[90vh] my-4 overflow-hidden p-0 flex flex-col",children:[(0,t.jsx)(N.DialogHeader,{className:"border-b pb-4 bg-white -mx-6 -mt-6 px-6 pt-6 mb-6",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg flex-shrink-0 shadow-md",children:e.player_name.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(N.DialogTitle,{className:"text-xl font-semibold text-gray-900 mb-2",children:e.player_name}),(0,t.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,t.jsx)(eL.Badge,{className:"bg-blue-100 text-blue-700 border-blue-200 border font-medium transition-all duration-200",children:q})}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Recruiter: ",e.recruiter]})]})]})}),(0,t.jsxs)(eA.Tabs,{defaultValue:"overview",className:"space-y-6",children:[(0,t.jsxs)(eA.TabsList,{className:"grid w-full grid-cols-3 bg-white shadow-sm",children:[(0,t.jsx)(eA.TabsTrigger,{value:"overview",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Overview"}),(0,t.jsx)(eA.TabsTrigger,{value:"invoices",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Invoices"}),(0,t.jsx)(eA.TabsTrigger,{value:"activity",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700 transition-all duration-200",children:"Activity"})]}),(0,t.jsxs)(eA.TabsContent,{value:"overview",className:"space-y-6 animate-fade-in",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(y.Label,{className:"text-sm font-medium text-gray-700",children:"Change Stage"})}),!x&&(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:()=>h(!0),className:"text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[(0,t.jsx)(j.Edit,{className:"h-4 w-4 mr-1"}),"Edit"]})]}),(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white mb-4",children:[(0,t.jsxs)(l.Select,{value:C?.toString()||"",onValueChange:z,disabled:F,children:[(0,t.jsx)(l.SelectTrigger,{className:"w-full",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select stage"})}),(0,t.jsx)(l.SelectContent,{children:c.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),F&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Saving..."})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(e$.Mail,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Email"}),(0,t.jsx)("p",{className:"font-medium text-gray-900 text-sm truncate",children:e.email})]})]})}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(eO.Phone,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Phone"}),(0,t.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e.phone})]})]})}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(T.GraduationCap,{className:"h-5 w-5 text-purple-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Programme"}),(0,t.jsx)(eL.Badge,{className:"bg-gradient-to-r from-blue-500 to-purple-500 text-white border-0 text-xs",children:e.programme})]})]})}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 bg-white hover:shadow-sm transition-shadow duration-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(A.UserCircle2,{className:"h-5 w-5 text-gray-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Recruiter"}),x?(0,t.jsxs)(l.Select,{value:g?.toString()||"",onValueChange:e=>f(Number.parseInt(e)),children:[(0,t.jsx)(l.SelectTrigger,{className:"h-8 text-sm",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select recruiter"})}),(0,t.jsx)(l.SelectContent,{children:I.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.full_name||e.name},e.id))})]}):(0,t.jsx)("p",{className:"font-medium text-gray-900 text-sm",children:e.recruiter})]})]})})]}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(L.DollarSign,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(y.Label,{htmlFor:"deal-value",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Deal Value"}),x?(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"£"}),(0,t.jsx)(i.Input,{id:"deal-value",type:"number",value:v,onChange:e=>b(e.target.value),placeholder:"0",className:"pl-8"})]}):(0,t.jsxs)("p",{className:"text-lg font-bold text-green-600",children:["£",e.deal_value?.toLocaleString()||"0"]})]})]})}),x&&(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,t.jsx)(y.Label,{htmlFor:"notes",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Notes"}),(0,t.jsx)(E.Textarea,{id:"notes",value:w,onChange:e=>S(e.target.value),placeholder:"Add notes about this deal...",rows:4,className:"resize-none"})]}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(o.Clock,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Last Contacted"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,t.jsx)("span",{children:"2 days ago"}),(0,t.jsx)("span",{className:"text-gray-400",children:"•"}),(0,t.jsx)(eL.Badge,{variant:"outline",className:"text-xs",children:"Email"})]})]})]})}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(eB.Calendar,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(y.Label,{htmlFor:"next-followup",className:"text-sm font-medium text-gray-900 mb-2 block",children:"Next Follow-Up"}),(0,t.jsx)(i.Input,{id:"next-followup",type:"date",value:_,onChange:e=>U(e.target.value),className:"focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200",disabled:M}),M&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Saving..."})]})]})}),x&&(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.Button,{onClick:H,className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:"Save Changes"}),(0,t.jsxs)(n.Button,{onClick:()=>{f(e?.recruiter_id||null),b(e?.deal_value?.toString()||""),S(e?.notes||""),h(!1)},variant:"outline",className:"flex-1 bg-transparent",children:[(0,t.jsx)(eR.X,{className:"mr-2 h-4 w-4"}),"Cancel"]})]}),!x&&(0,t.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,t.jsxs)(n.Button,{className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md hover:shadow-lg hover:shadow-blue-500/30 transition-all duration-200",size:"lg",children:[(0,t.jsx)(eV.Send,{className:"mr-2 h-4 w-4"}),"Send Message"]}),(0,t.jsx)(eJ.default,{href:"/pipelines",className:"block",children:(0,t.jsxs)(n.Button,{variant:"outline",className:"w-full border-2 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-700 transition-all duration-200 bg-transparent",size:"lg",children:["View in Pipeline",(0,t.jsx)(eM.ExternalLink,{className:"ml-2 h-4 w-4"})]})})]})]}),(0,t.jsxs)(eA.TabsContent,{value:"invoices",className:"animate-fade-in space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-blue-50 flex items-center justify-center",children:(0,t.jsx)($.FileText,{className:"h-5 w-5 text-blue-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-001"}),(0,t.jsxs)(eL.Badge,{className:"bg-green-100 text-green-700 hover:bg-green-100",children:[(0,t.jsx)(eU.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Paid"]})]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Registration Fee - ",e?.programme||"Program"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Issued: Jan 15, 2024 • Due: Jan 30, 2024"})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("p",{className:"font-bold text-lg",children:["£",e?.deal_value||"18,000"]})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{B({title:"Downloading Invoice",description:"Invoice #INV-2024-001 is being downloaded..."})},children:[(0,t.jsx)(d.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:[(0,t.jsx)(ez.CreditCard,{className:"h-4 w-4 mr-2"}),"Paid"]})]})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4 hover:border-blue-500 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-amber-50 flex items-center justify-center",children:(0,t.jsx)($.FileText,{className:"h-5 w-5 text-amber-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-002"}),(0,t.jsxs)(eL.Badge,{className:"bg-amber-100 text-amber-700 hover:bg-amber-100",children:[(0,t.jsx)(eH.AlertCircle,{className:"h-3 w-3 mr-1"}),"Pending"]})]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Program Deposit - ",e?.programme||"Program"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Issued: Feb 01, 2024 • Due: Feb 15, 2024"})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"font-bold text-lg",children:"£5,000"})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{B({title:"Downloading Invoice",description:"Invoice #INV-2024-002 is being downloaded..."})},children:[(0,t.jsx)(d.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,t.jsxs)(n.Button,{size:"sm",className:"bg-blue-600 hover:bg-blue-700",onClick:()=>{B({title:"Opening Payment Portal",description:"Redirecting to Stripe payment page..."})},children:[(0,t.jsx)(ez.CreditCard,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]}),(0,t.jsxs)("div",{className:"border border-red-200 rounded-lg p-4 hover:border-red-400 transition-colors bg-red-50/30",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-red-100 flex items-center justify-center",children:(0,t.jsx)($.FileText,{className:"h-5 w-5 text-red-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("h4",{className:"font-semibold",children:"Invoice #INV-2024-003"}),(0,t.jsxs)(eL.Badge,{className:"bg-red-100 text-red-700 hover:bg-red-100",children:[(0,t.jsx)(eH.AlertCircle,{className:"h-3 w-3 mr-1"}),"Overdue"]})]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Monthly Fee - ",e?.programme||"Program"]}),(0,t.jsx)("p",{className:"text-xs text-red-600 mt-1 font-medium",children:"Issued: Dec 01, 2023 • Due: Dec 15, 2023"})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("p",{className:"font-bold text-lg text-red-600",children:"£2,500"})})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{B({title:"Downloading Invoice",description:"Invoice #INV-2024-003 is being downloaded..."})},children:[(0,t.jsx)(d.Download,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),(0,t.jsxs)(n.Button,{size:"sm",className:"bg-red-600 hover:bg-red-700",onClick:()=>{B({title:"Opening Payment Portal",description:"Redirecting to Stripe payment page..."})},children:[(0,t.jsx)(ez.CreditCard,{className:"h-4 w-4 mr-2"}),"Pay Now"]})]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total Invoiced"}),(0,t.jsxs)("span",{className:"font-semibold",children:["£",(parseFloat(e?.deal_value?.toString()||"18000")+7500).toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total Paid"}),(0,t.jsxs)("span",{className:"font-semibold text-green-600",children:["£",e?.deal_value||"18,000"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Outstanding"}),(0,t.jsx)("span",{className:"font-semibold text-red-600",children:"£7,500"})]})]})]}),(0,t.jsx)(eA.TabsContent,{value:"activity",className:"animate-fade-in",children:(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"relative space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,t.jsx)(eq.Activity,{className:"h-4 w-4 text-blue-600"})}),(0,t.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Stage updated"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Moved to ",(0,t.jsx)("span",{className:"font-semibold",children:e?.stage_name||"Zoom Scheduled"})]})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"2 hours ago"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",e?.recruiter||"Sarah"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)(e$.Mail,{className:"h-4 w-4 text-green-600"})}),(0,t.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Email sent"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Follow-up email sent to player"})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"5 hours ago"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",e?.recruiter||"Sarah"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-purple-100 flex items-center justify-center",children:(0,t.jsx)($.FileText,{className:"h-4 w-4 text-purple-600"})}),(0,t.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Note added"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e?.notes||"Player expressed strong interest in the program. Follow-up scheduled for next week."})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"1 day ago"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",e?.recruiter||"Sarah"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-amber-100 flex items-center justify-center",children:(0,t.jsx)(eO.Phone,{className:"h-4 w-4 text-amber-600"})}),(0,t.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Phone call"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Outbound call - 15 minutes"})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"2 days ago"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",e?.recruiter||"Sarah"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)(eU.CheckCircle2,{className:"h-4 w-4 text-green-600"})}),(0,t.jsx)("div",{className:"w-px flex-1 bg-gray-200 mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Payment received"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Invoice #INV-2024-001 paid - £",e?.deal_value||"18,000"]})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"3 days ago"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"via Stripe"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"flex flex-col items-center",children:(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center",children:(0,t.jsx)(A.UserCircle2,{className:"h-4 w-4 text-gray-600"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Deal created"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Player added to pipeline"})]}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"1 week ago"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["by ",e?.recruiter||"Sarah"]})]})]})]})})})]})]})})}function eK(){var e;let r=(0,s.useSearchParams)(),u=r.get("pipelineId"),x=r.get("dealId"),[h,p]=(0,a.useState)([]),[g,f]=(0,a.useState)([]),[v,j]=(0,a.useState)(u||""),[b,N]=(0,a.useState)("all"),[y,w]=(0,a.useState)({from:null,to:null}),[S,C]=(0,a.useState)("newest"),[k,E]=(0,a.useState)(null),[I,P]=(0,a.useState)(null),[T,F]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1),[$,O]=(0,a.useState)(""),[M,V]=(0,a.useState)("all"),[B,R]=(0,a.useState)("all"),[z,U]=(0,a.useState)("all"),[H,q]=(0,a.useState)(!1),[J,W]=(0,a.useState)(!1),[K,G]=(0,a.useState)(!1),[Z,Y]=(0,a.useState)(null),[X,Q]=(0,a.useState)(!1),ee=async()=>{let e=await fetch("/api/pipelines"),t=await e.json();p(t),t.length>0&&!v&&j(t[0].id.toString())};(0,a.useEffect)(()=>{ee()},[]),(0,a.useEffect)(()=>{u&&j(u)},[u]),(0,a.useEffect)(()=>{if(x&&k){let e=null;for(let t of k.stages){let a=t.deals.find(e=>e.id.toString()===x);if(a){e=a;break}}e&&(P(e),F(!0))}},[x,k]),(0,a.useEffect)(()=>{fetch("/api/settings/recruiters").then(e=>e.json()).then(e=>f(e))},[]),(0,a.useEffect)(()=>{v&&(L(!0),fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>{E(e),L(!1)}))},[v]),(0,a.useEffect)(()=>{let e=e=>{let t=e.detail;t&&k?E(e=>e?{...e,stages:e.stages.map(e=>e.id===t.stage_id?{...e,deals:[...e.deals,t]}:e)}:e):v&&fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>E(e))};return window.addEventListener("dealCreated",e),()=>window.removeEventListener("dealCreated",e)},[v,k]),(0,a.useEffect)(()=>{let e=()=>{v&&fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>E(e))};return window.addEventListener("stageCreated",e),()=>window.removeEventListener("stageCreated",e)},[v]),(0,a.useEffect)(()=>{let e=()=>{v&&fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>E(e))};return window.addEventListener("stageDeleted",e),()=>window.removeEventListener("stageDeleted",e)},[v]);let et=async(e,t)=>{try{if((await fetch(`/api/deals/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({stage_id:t})})).ok&&v){let e=await fetch(`/api/pipelines/${v}/stages`).then(e=>e.json());E(e)}}catch(e){console.error("Failed to update deal:",e)}},ea=async(e,t,a,s)=>{try{if((await fetch(`/api/pipelines/${v}/stages/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,color:a,order:s})})).ok){let e=await fetch(`/api/pipelines/${v}/stages`).then(e=>e.json());E(e)}}catch(e){console.error("Failed to update stage:",e)}},es=k?{...k,stages:k.stages.map(e=>{let t=e.deals;$&&(t=t.filter(e=>e.player_name.toLowerCase().includes($.toLowerCase()))),"all"!==b&&(t=t.filter(e=>e.recruiter===g.find(e=>e.id.toString()===b)?.name)),(y.from||y.to)&&(t=t.filter(e=>{let t=new Date(e.last_activity);return(!y.from||!(t<y.from))&&(!y.to||!(t>y.to))}));let a=[...t].sort((e,t)=>"newest"===S?new Date(t.last_activity).getTime()-new Date(e.last_activity).getTime():"value"===S?(t.deal_value||0)-(e.deal_value||0):"recruiter"===S?e.recruiter.localeCompare(t.recruiter):0);return{...e,deals:a}})}:null,er=es?es.stages.reduce((e,t)=>e+t.deals.length,0):0,el=es?es.stages.reduce((e,t)=>e+t.deals.reduce((e,t)=>e+(t.deal_value||0),0),0):0;return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"flex-shrink-0 space-y-4 pb-4",children:[(0,t.jsx)("div",{className:"rounded-lg border border-border bg-card p-4 shadow-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(e_.Popover,{open:J,onOpenChange:W,children:[(0,t.jsx)(e_.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"gap-2 text-muted-foreground hover:bg-muted hover:border-primary transition-colors bg-transparent",children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Add a filter"]})}),(0,t.jsx)(e_.PopoverContent,{className:"w-56 p-3",align:"start",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-foreground mb-3",children:"Available Filters"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{W(!1)},children:"Deal owner"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{W(!1)},children:"Status"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{W(!1)},children:"Tags"}),(0,t.jsx)(n.Button,{variant:"ghost",size:"sm",className:"w-full justify-start text-sm",onClick:()=>{W(!1)},children:"Recruiter"})]})})]}),(0,t.jsxs)(l.Select,{value:M,onValueChange:V,children:[(0,t.jsx)(l.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,t.jsx)(l.SelectValue,{placeholder:"All owners"})}),(0,t.jsxs)(l.SelectContent,{children:[(0,t.jsx)(l.SelectItem,{value:"all",children:"All owners"}),g.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))]})]}),(0,t.jsxs)(l.Select,{value:B,onValueChange:R,children:[(0,t.jsx)(l.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,t.jsx)(l.SelectValue,{placeholder:"All statuses"})}),(0,t.jsxs)(l.SelectContent,{children:[(0,t.jsx)(l.SelectItem,{value:"all",children:"All statuses"}),(0,t.jsx)(l.SelectItem,{value:"in-pipeline",children:"In Pipeline"}),(0,t.jsx)(l.SelectItem,{value:"contacted",children:"Contacted"}),(0,t.jsx)(l.SelectItem,{value:"signed",children:"Signed"})]})]}),(0,t.jsxs)(l.Select,{value:z,onValueChange:U,children:[(0,t.jsx)(l.SelectTrigger,{className:"h-9 w-[120px] border-border hover:border-primary focus:border-primary transition-colors",children:(0,t.jsx)(l.SelectValue,{placeholder:"All tags"})}),(0,t.jsxs)(l.SelectContent,{children:[(0,t.jsx)(l.SelectItem,{value:"all",children:"All tags"}),(0,t.jsx)(l.SelectItem,{value:"high-priority",children:"High Priority"}),(0,t.jsx)(l.SelectItem,{value:"follow-up",children:"Follow Up"})]})]}),(0,t.jsxs)(l.Select,{value:b,onValueChange:N,children:[(0,t.jsx)(l.SelectTrigger,{className:"h-9 w-[140px] border-border hover:border-primary transition-colors",children:(0,t.jsx)(l.SelectValue,{placeholder:"All recruiters"})}),(0,t.jsxs)(l.SelectContent,{children:[(0,t.jsx)(l.SelectItem,{value:"all",children:"All recruiters"}),g.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative w-[240px]",children:[(0,t.jsx)(m.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(i.Input,{placeholder:"Search deals",value:$,onChange:e=>O(e.target.value),className:"h-9 pl-10 border-border hover:border-primary focus:border-primary transition-colors"})]}),(0,t.jsxs)(l.Select,{value:v,onValueChange:j,children:[(0,t.jsx)(l.SelectTrigger,{className:"h-9 w-[260px] border-border hover:border-primary transition-colors font-medium",children:(0,t.jsx)(l.SelectValue,{placeholder:"Select pipeline"})}),(0,t.jsxs)(l.SelectContent,{className:"w-[260px]",children:[(0,t.jsx)("div",{className:"px-2 pb-2 pt-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(m.Search,{className:"absolute left-2 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-foreground"}),(0,t.jsx)(i.Input,{placeholder:"Search pipelines...",className:"h-8 pl-8 text-sm border-border focus:border-primary"})]})}),(0,t.jsx)("div",{className:"max-h-[300px] overflow-y-auto",children:h.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id.toString(),className:"cursor-pointer px-3 py-2.5",children:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsx)("span",{className:"text-[15px] font-medium text-foreground",children:e.name}),void 0!==e.dealCount&&(0,t.jsxs)("span",{className:"text-[13px] text-muted-foreground ml-2",children:["(",e.dealCount,")"]})]})},e.id))}),(0,t.jsx)("div",{className:"my-1 mx-2",children:(0,t.jsx)("div",{className:"h-px bg-border"})}),(0,t.jsxs)("button",{type:"button",onClick:e=>{e.preventDefault(),q(!0)},className:"relative flex w-full cursor-pointer select-none items-center rounded-sm px-3 py-2.5 text-[15px] font-medium text-primary hover:bg-accent outline-none transition-colors",children:[(0,t.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Add a pipeline"]})]})]})]})]})}),es&&(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-border bg-muted/30 px-6 py-3 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Total players:"}),(0,t.jsx)("span",{className:"text-lg font-bold text-primary",children:er})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Total value:"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-success",children:["£",el.toLocaleString()]})]}),void 0!==es.dealsWon&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Deals won:"}),(0,t.jsx)("span",{className:"text-lg font-bold text-primary",children:es.dealsWon})]}),void 0!==es.conversionRate&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:"Conversion rate:"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-success",children:[es.conversionRate.toFixed(1),"%"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(o.Clock,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Last updated: ",(e=new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})+" at "+e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})]})]})]}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",className:"gap-2 bg-card transition-all duration-200 hover:bg-muted hover:shadow-md",children:[(0,t.jsx)(d.Download,{className:"h-4 w-4"}),"Export CSV"]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-x-auto overflow-y-hidden",children:A?(0,t.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Loading pipeline..."})}):es?0===es.stages.length?(0,t.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,t.jsx)("div",{className:"text-center space-y-4",children:(0,t.jsxs)("div",{className:"rounded-lg bg-muted/50 border border-border p-8 max-w-md mx-auto",children:[(0,t.jsx)("p",{className:"text-base font-medium text-foreground mb-2",children:"No stages yet — create your first one"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Add stages to organize your deals through the recruitment process."}),(0,t.jsxs)(n.Button,{onClick:()=>Q(!0),className:"gradient-primary",children:[(0,t.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Add Stage"]})]})})}):(0,t.jsx)(_,{pipelineData:es,onDealClick:e=>{P(e),F(!0)},onDealMove:et,onStageEdit:ea,onAddDeal:e=>{Y(e),G(!0)}}):(0,t.jsx)("div",{className:"flex h-64 items-center justify-center",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Select a pipeline to view deals"})})}),I&&es&&(0,t.jsx)(eW,{deal:I,open:T,onClose:()=>F(!1),stages:es.stages.map(e=>({id:e.id,name:e.name})),pipelineId:Number.parseInt(v),onDealUpdated:e=>{k&&E({...k,stages:k.stages.map(t=>({...t,deals:t.deals.map(t=>t.id===e.id?{...t,...e}:t)}))}),v&&fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>E(e))}}),(0,t.jsx)(D,{open:H,onClose:()=>q(!1),onSuccess:()=>{ee()}}),(0,t.jsx)(eE,{open:K,onClose:()=>{G(!1),Y(null)},preSelectedStageId:Z,onDealCreated:e=>{k&&e.stage_id&&E({...k,stages:k.stages.map(t=>t.id===e.stage_id?{...t,deals:[...t.deals,e]}:t)}),v&&fetch(`/api/pipelines/${v}/stages`).then(e=>e.json()).then(e=>E(e))}}),X&&v&&(0,t.jsx)(eF,{open:X,onClose:()=>Q(!1),pipelineId:Number.parseInt(v)})]})}var eG=e.i(70065),eZ=e.i(25652),eY=e.i(64030),eX=e.i(73884);function eQ({pipelineId:e}){let[s,r]=(0,a.useState)({active:0,won:0,lost:0,totalValue:0,conversionRate:0});(0,a.useEffect)(()=>{e&&l(e)},[e]);let l=async e=>{try{let t=await fetch(`/api/pipelines/${e}/stats`),a=await t.json();r(a)}catch(e){console.error("Failed to fetch deal statistics:",e),r({active:47,won:23,lost:8,totalValue:125e3,conversionRate:74.2})}},n=[{title:"Active Deals",value:s.active,icon:eq.Activity,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",description:"Currently in pipeline"},{title:"Won Deals",value:s.won,icon:eY.Trophy,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",description:"Successfully closed"},{title:"Lost Deals",value:s.lost,icon:eX.XCircle,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",description:"Not converted"},{title:"Conversion Rate",value:`${s.conversionRate}%`,icon:eZ.TrendingUp,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",description:"Win rate"}];return(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:n.map((e,a)=>{let s=e.icon;return(0,t.jsx)(eG.Card,{className:`relative overflow-hidden border-2 ${e.borderColor} transition-all duration-200 hover:shadow-lg`,style:{animationDelay:`${100*a}ms`},children:(0,t.jsxs)(eG.CardContent,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:e.title}),(0,t.jsx)("p",{className:"text-3xl font-bold tracking-tight text-foreground",children:e.value}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.description})]}),(0,t.jsx)("div",{className:`flex h-12 w-12 items-center justify-center rounded-xl ${e.bgColor}`,children:(0,t.jsx)(s,{className:`h-6 w-6 ${e.color}`})})]}),(0,t.jsx)("div",{className:`absolute top-0 right-0 w-32 h-32 ${e.bgColor} opacity-10 rounded-full -mr-16 -mt-16`})]})},e.title)})})}let e0=(0,g.default)("ListTree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]);var e1=e.i(20755);function e2(){let[e,l]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[o,m]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)("1"),[g,f]=(0,a.useState)(null),v=(0,s.useRouter)(),j=(0,s.useSearchParams)();if((0,a.useEffect)(()=>{let e=(0,e1.createClient)();e.auth.getUser().then(({data:{user:t},error:a})=>{a||!t?v.push("/auth/login"):(l(t),e.from("profiles").select("role").eq("id",t.id).single().then(({data:e})=>{e&&d(e.role)}))})},[v]),(0,a.useEffect)(()=>{if("create_deal"===j.get("action")){let e=j.get("playerId"),t=j.get("playerName"),a=j.get("playerEmail"),s=j.get("playerPhone");e&&t&&(f({id:e,name:t,email:a||void 0,phone:s||void 0}),m(!0))}},[j]),!e)return null;let b="admin"===i||"manager"===i;return(0,t.jsxs)(r.AppLayout,{user:e,title:"Pipelines",children:[(0,t.jsxs)("div",{className:"flex flex-col h-full max-w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex-shrink-0",children:[(0,t.jsx)("div",{className:"gradient-primary mb-6 flex h-[72px] items-center rounded-2xl px-6 shadow-[0_2px_6px_rgba(0,0,0,0.06)]",children:(0,t.jsxs)("div",{className:"flex w-full flex-col items-start justify-between gap-4 sm:flex-row sm:items-center",children:[(0,t.jsx)("p",{className:"text-base text-white",style:{fontFamily:"Inter, sans-serif",fontWeight:400},children:"Track deals through your recruitment stages."}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(n.Button,{onClick:()=>{f(null),m(!0)},className:"gap-2 bg-white text-primary shadow-md hover:bg-muted transition-all duration-200 hover:shadow-lg active:scale-95",children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"New Deal"]}),b&&(0,t.jsxs)(n.Button,{onClick:()=>x(!0),className:"gap-2 bg-white text-primary shadow-md hover:bg-muted transition-all duration-200 hover:shadow-lg active:scale-95",children:[(0,t.jsx)(e0,{className:"h-4 w-4"}),"Add Stage"]})]})]})}),(0,t.jsx)(eQ,{pipelineId:h})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,t.jsx)(eK,{})})]}),(0,t.jsx)(eE,{open:o,onClose:()=>{m(!1),f(null),v.replace("/pipelines")},preSelectedPlayer:g,onDealCreated:e=>{let t=new CustomEvent("dealCreated",{detail:e});window.dispatchEvent(t)}}),b&&(0,t.jsx)(eF,{open:u,onClose:()=>x(!1)})]})}function e5(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}),children:(0,t.jsx)(e2,{})})}e.s(["default",()=>e5],50393)}]);